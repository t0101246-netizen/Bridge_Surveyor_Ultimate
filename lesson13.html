<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 13: ä¸Šå¸çš„è¦–è§’â€”â€”ç„¡äººæ©Ÿèˆªæ¸¬ (UAV)</title>
    <style>
        :root {
            --bg-theory: #e0f2fe; /* å¤©ç©ºè—èƒŒæ™¯ */
            --bg-field: #fffaf0;
            --bg-tool: #0c4a6e; /* æ·±ç©ºè— */
            --text-main: #334155;
            --text-light: #f0f9ff;
            --accent-sky: #0ea5e9; /* èˆªç©ºè— */
            --accent-ground: #854d0e; /* å¤§åœ°æ£• */
            --border-color: #cbd5e1;
            --tech-font: 'Fira Code', 'Consolas', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-sky);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-sky); color: #0369a1; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-ground); color: #713f12; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
            position: sticky;
            top: 20px;
            border: 1px solid #7dd3fc;
        }
        .tool-panel h2 { color: var(--accent-sky); text-transform: uppercase; letter-spacing: 2px; }

        /* Python Code Block */
        .code-block {
            background: #0f172a;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: var(--tech-font);
            font-size: 14px;
            color: #d4d4d4;
            border: 1px solid #334155;
            margin-bottom: 20px;
        }
        .kw { color: #c084fc; } 
        .fn { color: #60a5fa; } 
        .str { color: #4ade80; } 
        .com { color: #64748b; }

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* Volume Simulator */
        .sim-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            background: #082f49; padding: 15px; border-radius: 8px; margin-bottom: 15px;
        }
        .sim-input label { display: block; font-size: 12px; color: #7dd3fc; margin-bottom: 5px; }
        .sim-input input { 
            width: 100%; padding: 8px; background: #0c4a6e; border: 1px solid #38bdf8; color: white; border-radius: 4px; 
            font-family: var(--tech-font); text-align: right;
        }

        .visualizer {
            background: #000; height: 200px; width: 100%; position: relative;
            border-bottom: 2px solid #38bdf8;
            overflow: hidden;
        }
        .terrain-layer { position: absolute; bottom: 0; width: 100%; opacity: 0.8; transition: all 0.5s; }
        
        .btn {
            background: var(--accent-sky);
            color: white; border: none; padding: 12px;
            font-size: 16px; border-radius: 4px; cursor: pointer; font-weight: bold; width: 100%;
            transition: background 0.2s;
        }
        .btn:hover { background: #0284c7; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 13: ä¸Šå¸çš„è¦–è§’ â€” ç„¡äººæ©Ÿèˆªæ¸¬ (UAV)</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Masters Program: ç”¨å¹¾åƒå¼µç…§ç‰‡æ‹¼å‡ºåœ°çƒçš„å½¢ç‹€ã€‚å¾ DSM åˆ° DTMï¼Œé€™æ˜¯ä¸€å ´å»è•ªå­˜èçš„æˆ°çˆ­ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸ¦… ç›´è§€è­¬å–»ï¼šè’¼è …çš„è¤‡çœ¼</h2>
        <p>äººé¡çš„å…©éš»çœ¼ç›èƒ½ç”¢ç”Ÿç«‹é«”æ„Ÿï¼ˆé›™ç›®è¦–è¦ºï¼‰ã€‚
        <br>ç„¡äººæ©Ÿèˆªæ¸¬çš„åŸç† <strong>SfM (Structure from Motion)</strong>ï¼Œå°±åƒæ˜¯æœ‰å¹¾åƒéš»çœ¼ç›åŒæ™‚ç›¯è‘—åœ°é¢ã€‚
        <br>ç„¡äººæ©Ÿåœ¨é£›è¡Œæ™‚ï¼Œå°åŒä¸€å€‹ç‰©é«”å¾ä¸åŒè§’åº¦æ‹äº†å¥½å¹¾å¼µç…§ç‰‡ï¼ˆé«˜é‡ç–Šç‡ï¼‰ã€‚é›»è…¦é€šéæ¯”å°é€™äº›ç…§ç‰‡ä¸­çš„ã€Œç‰¹å¾µé»ã€ï¼Œå°±èƒ½åç®—å‡ºç‰©é«”çš„ 3D æ·±åº¦ï¼Œå°±åƒä½ çš„å¤§è…¦æŠŠå·¦å³çœ¼çš„å½±åƒåˆæˆå‡ºç«‹é«”ä¸–ç•Œä¸€æ¨£ã€‚</p>

        <h2>ğŸ”ï¸ è¦–è¦ºåœ–è§£ï¼šDSM vs DTM</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg">
                <path d="M 0 250 L 800 250 L 800 300 L 0 300 Z" fill="#713f12" />
                
                <path d="M 0 250 Q 200 200 400 250 T 800 220" fill="none" stroke="#eab308" stroke-width="4" stroke-dasharray="5"/>
                <text x="50" y="270" fill="#eab308" font-weight="bold">DTM (æ•¸ä½åœ°å½¢æ¨¡å‹)</text>
                
                <g transform="translate(150, 225)">
                    <rect x="0" y="-40" width="20" height="40" fill="#65a30d"/> <circle cx="10" cy="-50" r="30" fill="#65a30d" opacity="0.8"/> </g>
                <g transform="translate(600, 235)">
                    <rect x="0" y="-30" width="40" height="30" fill="#ef4444"/> </g>

                <path d="M 0 250 Q 150 225 150 175 L 170 175 Q 170 225 300 235 T 600 205 L 640 205 L 650 225 T 800 220" fill="none" stroke="#0ea5e9" stroke-width="3"/>
                <text x="50" y="150" fill="#0ea5e9" font-weight="bold">DSM (æ•¸ä½è¡¨é¢æ¨¡å‹)</text>

                <path d="M 50 50 L 750 50" stroke="#94a3b8" stroke-dasharray="10"/>
                <image href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23333'><path d='M22 14h-2.1l-1.9-5h-3l-2-4h-2l-2 4h-3l-1.9 5H2v2h20v-2z'/></svg>" x="380" y="35" width="40" height="40"/>
                
                <path d="M 400 60 L 300 250" stroke="#cbd5e1" opacity="0.5"/>
                <path d="M 400 60 L 500 250" stroke="#cbd5e1" opacity="0.5"/>

            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šåœŸæ–¹è¨ˆç®—çš„æ­»æ•µæ˜¯ DSMã€‚å¦‚æœä½ ç®—åœŸæ–¹æ™‚æ²’æŠŠã€Œæ¨¹ã€å’Œã€ŒæŒ–åœŸæ©Ÿã€æ¿¾æ‰ (ä¹Ÿå°±æ˜¯æ²’è½‰æˆ DTM)ï¼Œä½ çš„æ¥­ä¸»æœƒå› ç‚ºå¤šä»˜äº†å¹¾ç™¾è¬è€Œæ®ºäº†ä½ ã€‚</p>
        </div>

        <h2>ğŸ§® ç¡¬æ ¸ç†è«–ï¼šé«”ç©ç©åˆ†</h2>
        <p>åœŸæ–¹é‡ $V$ æ˜¯é€šéå°‡ç¶²æ ¼ï¼ˆGridï¼‰ä¸­æ¯å€‹åƒç´ çš„é«˜ç¨‹å·®ç©åˆ†å¾—å‡ºçš„ã€‚</p>
        <div class="math-card">
            V = \sum_{i=1}^{n} (H_{DSM, i} - H_{Design, i}) \times GSD^2
        </div>
        <ul>
            <li>$GSD$ (åœ°é¢æ¡æ¨£è·é›¢)ï¼šç…§ç‰‡ä¸Š 1 å€‹åƒç´ ä»£è¡¨å¯¦éš›åœ°é¢å¹¾å…¬åˆ†ã€‚é€šå¸¸é£› 100m é«˜ï¼ŒGSD ç´„ç‚º 2-3cmã€‚</li>
            <li>$H_{DSM}$ï¼šæ¸¬é‡é«˜ç¨‹ã€‚</li>
            <li>$H_{Design}$ï¼šè¨­è¨ˆé«˜ç¨‹ (æˆ–é–‹æŒ–å‰é«˜ç¨‹)ã€‚</li>
        </ul>
        <p><strong>èª¤å·®ä¾†æºï¼š</strong> 1. GSD å¤ªå¤§ (é£›å¤ªé«˜)ã€‚ 2. é‚Šç·£è®Šå½¢ (é­šçœ¼æ•ˆæ‡‰)ã€‚ 3. æ¤è¢«æœªæ¿¾é™¤ (DTM è£½ä½œå¤±æ•—)ã€‚</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šæ§åˆ¶é»æ˜¯ç”Ÿå‘½</h2>
            
            <h3>1. GCP (åœ°é¢æ§åˆ¶é») ä¸èƒ½çœ</h3>
            <p>ä¸è¦ç›¸ä¿¡ç„¡äººæ©Ÿè‡ªå¸¶çš„ GPSï¼é‚£åªæœ‰ 3-5 å…¬å°ºçš„ç²¾åº¦ã€‚
            <br>æƒ³è¦ç®—åœŸæ–¹ï¼Œä½ å¿…é ˆåœ¨åœ°ä¸Šä½ˆè¨­ <strong>GCP (Ground Control Points)</strong>ã€‚
            <br>â— <strong>å¯†åº¦ï¼š</strong> æ¯ 5-10 å…¬é ƒè‡³å°‘ 5 å€‹é»ï¼ˆå››è§’+ä¸­å¿ƒï¼‰ã€‚
            <br>â— <strong>æ¸¬é‡ï¼š</strong> ç”¨ RTK æˆ–å…¨ç«™å„€æ¸¬å‡º GCP çš„ç²¾ç¢ºåæ¨™ã€‚
            <br>æ²’æœ‰ GCP çš„æ¨¡å‹ï¼Œå°±åƒæ¼‚æµ®åœ¨ç©ºä¸­çš„æœå‡ï¼Œéš¨æ™‚æœƒæ‰­æ›²è®Šå½¢ã€‚</p>

            <h3>2. é‡ç–Šç‡ (Overlap) çš„é»ƒé‡‘æ³•å‰‡</h3>
            <p>ç‚ºäº†ç¢ºä¿ SfM ç®—æ³•èƒ½æ‰¾åˆ°ç‰¹å¾µé»ï¼š
            <br>â— <strong>èˆªå‘é‡ç–Š (Front Overlap)ï¼š</strong> è‡³å°‘ <strong>75% - 80%</strong>ã€‚
            <br>â— <strong>æ—å‘é‡ç–Š (Side Overlap)ï¼š</strong> è‡³å°‘ <strong>60% - 70%</strong>ã€‚
            <br>å¦‚æœä½ ç‚ºäº†çœé›»æ± è€Œé£›å¤ªå¿«æˆ–é–“è·å¤ªå¯¬ï¼Œå›å»è·‘åœ–æ™‚å°±æœƒå‡ºç¾ã€Œç ´æ´ã€ï¼Œåˆ°æ™‚å€™åªèƒ½å“­è‘—é‡é£›ã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸš Python å¯¦æˆ°ï¼šRasterio åœŸæ–¹è¨ˆç®—</h2>
            <div class="code-block">
<span class="kw">import</span> rasterio
<span class="kw">import</span> numpy <span class="kw">as</span> np

<span class="kw">def</span> <span class="fn">calculate_volume</span>(dsm_path, base_level):
    <span class="kw">with</span> rasterio.<span class="fn">open</span>(dsm_path) <span class="kw">as</span> src:
        <span class="com"># 1. è®€å–é«˜ç¨‹æ•¸æ“šçŸ©é™£</span>
        elevation_data = src.read(<span class="str">1</span>)
        
        <span class="com"># 2. ç²å–åƒç´ é¢ç© (GSD^2)</span>
        res_x = src.res[<span class="str">0</span>] <span class="com"># e.g., 0.05m</span>
        res_y = src.res[<span class="str">1</span>]
        pixel_area = res_x * res_y

        <span class="com"># 3. éæ¿¾ç„¡æ•ˆå€¼ (NoData)</span>
        valid_mask = elevation_data != src.nodata
        valid_elev = elevation_data[valid_mask]

        <span class="com"># 4. è¨ˆç®—é«˜ç¨‹å·® (é«˜æ–¼åŸºæº–é¢æ‰ç®—å¡«æ–¹)</span>
        diff = valid_elev - base_level
        fill_volume = np.sum(diff[diff > <span class="str">0</span>]) * pixel_area
        
        <span class="kw">return</span> fill_volume
            </div>

            <h2>ğŸ—ï¸ äº’å‹•æ¨¡æ“¬ï¼šåœŸæ–¹é‡é«”ä¼°ç®—å™¨</h2>
            <p style="font-size:12px; color:#7dd3fc; margin-bottom:10px;">æ¨¡æ“¬ä¸€å€‹ 100m x 100m çš„åœŸæ–¹å †ç©å ´ã€‚</p>
            
            <div class="sim-grid">
                <div class="sim-input">
                    <label>å ´åœ°é¢ç© (mÂ²)</label>
                    <input type="number" id="area" value="10000" disabled>
                </div>
                <div class="sim-input">
                    <label>å¹³å‡å †åœŸé«˜åº¦ (m)</label>
                    <input type="number" id="avg-height" value="3.5" step="0.1" oninput="updateVis()">
                </div>
                <div class="sim-input">
                    <label>GSD è§£æåº¦ (cm)</label>
                    <input type="number" id="gsd" value="5" step="1">
                </div>
                <div class="sim-input">
                    <label>æ¤è¢«é›œè¨Šå¹²æ“¾ (%)</label>
                    <input type="number" id="noise" value="10" step="5" placeholder="æœªç§»é™¤æ¤è¢«æ¯”ä¾‹">
                </div>
            </div>

            <div class="visualizer" id="vis-container">
                <div id="vis-base" style="position:absolute; bottom:0; height:20px; width:100%; background:#854d0e;"></div>
                <div id="vis-soil" style="position:absolute; bottom:20px; height:0px; width:100%; background:#eab308; transition: height 0.3s;"></div>
                <div id="vis-veg" style="position:absolute; bottom:20px; height:0px; width:100%; background:repeating-linear-gradient(45deg, #65a30d, #65a30d 10px, #000 10px, #000 20px); opacity:0.5;"></div>
                <div style="position:absolute; top:10px; left:10px; color:white; font-size:12px; font-family:monospace;">
                    DSM Profile Preview
                </div>
            </div>

            <div style="background:#0f172a; padding:15px; margin-top:10px; border-radius:4px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <span style="color:#eab308;">ç´”åœŸæ–¹é«”ç© (Net):</span>
                    <span id="res-net" style="color:white; font-weight:bold;">0 mÂ³</span>
                </div>
                <div style="display:flex; justify-content:space-between;">
                    <span style="color:#0ea5e9;">å«é›œè¨Šé«”ç© (Raw DSM):</span>
                    <span id="res-raw" style="color:#ef4444; font-weight:bold;">0 mÂ³</span>
                </div>
                <div style="font-size:11px; color:#94a3b8; text-align:right; margin-top:5px;">
                    èª¤å·®: <span id="res-err">0%</span>
                </div>
            </div>

            <button class="btn" style="margin-top:15px;" onclick="calculateSim()">ğŸ”„ é‡æ–°è¨ˆç®—</button>
        </div>

    </div>
</div>

<script>
    function updateVis() {
        // ç´”è¦–è¦ºæ›´æ–°
        const h = parseFloat(document.getElementById('avg-height').value);
        // é™åˆ¶é¡¯ç¤ºé«˜åº¦
        const displayH = Math.min(h * 10, 150); 
        document.getElementById('vis-soil').style.height = displayH + 'px';
        
        const noise = parseFloat(document.getElementById('noise').value);
        // é›œè¨Šé«˜åº¦ (å‡è¨­é›œè¨Šå¹³å‡æ¯”åœŸé«˜ 1m)
        const noiseH = displayH + 20; 
        document.getElementById('vis-veg').style.height = noiseH + 'px';
        document.getElementById('vis-veg').style.width = noise + '%';
        document.getElementById('vis-veg').style.left = (100 - noise) / 2 + '%';
    }

    function calculateSim() {
        const area = 10000;
        const h = parseFloat(document.getElementById('avg-height').value);
        const noisePct = parseFloat(document.getElementById('noise').value);
        
        // çœŸå¯¦é«”ç©
        const netVol = area * h;

        // é›œè¨Šé«”ç© (å‡è¨­é›œè¨Šå€åŸŸå¹³å‡é«˜å‡º 1.5mï¼Œä¾‹å¦‚è‰å¢æˆ–æ¨¹)
        const noiseArea = area * (noisePct / 100);
        const noiseVol = noiseArea * (h + 1.5);
        const cleanArea = area - noiseArea;
        const cleanVol = cleanArea * h;
        
        const rawVol = cleanVol + noiseVol;
        const error = ((rawVol - netVol) / netVol) * 100;

        // Animation
        let currentNet = 0;
        let currentRaw = 0;
        const steps = 20;
        const stepNet = netVol / steps;
        const stepRaw = rawVol / steps;

        const interval = setInterval(() => {
            currentNet += stepNet;
            currentRaw += stepRaw;
            
            if(currentNet >= netVol) {
                currentNet = netVol;
                currentRaw = rawVol;
                clearInterval(interval);
            }

            document.getElementById('res-net').innerText = Math.round(currentNet).toLocaleString() + " mÂ³";
            document.getElementById('res-raw').innerText = Math.round(currentRaw).toLocaleString() + " mÂ³";
            document.getElementById('res-err').innerText = "+" + error.toFixed(1) + "%";
            
            if(error > 5) {
                document.getElementById('res-raw').style.color = "#ef4444"; // Red warning
            } else {
                document.getElementById('res-raw').style.color = "#4ade80"; // Green ok
            }
        }, 30);

        updateVis();
    }

    // Init
    updateVis();
    calculateSim();
</script>
<!-- NAV SCRIPT START -->
<script>
(function(){
    // è‡ªå‹•ç”Ÿæˆå°è¦½æŒ‰éˆ•
    const total=13; // ç¸½èª²æ•¸
    const page=location.pathname.split("/").pop();
    const num=parseInt(page.match(/lesson(\d+)\.html/i)?.[1]||0);
    if(!num)return;
    
    const prev=num>1?`lesson${String(num-1).padStart(2,'0')}.html`:'index.html';
    const next=num<total?`lesson${String(num+1).padStart(2,'0')}.html`:'#';
    const bg='#0f172a'; const color='white';

    const div=document.createElement('div');
    div.style.cssText="position:fixed;bottom:20px;right:20px;display:flex;gap:10px;z-index:9999;font-family:Consolas,monospace;";
    div.innerHTML=`
        <a href="${prev}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">â† PREV</a>
        <a href="index.html" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">MENU</a>
        <a href="${next}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;opacity:${num>=total?0.5:1};pointer-events:${num>=total?'none':'auto'}">NEXT â†’</a>
    `;
    document.body.appendChild(div);
})();
</script>
<!-- NAV SCRIPT END -->
</body>

</html>
