<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 08: è±æ›²ç·šèˆ‡è¶…é«˜â€”â€”èˆ’é©åº¦çš„ç§˜å¯†</title>
    <style>
        :root {
            --bg-theory: #ecfeff; /* é’ç©ºè‰²ï¼Œè±¡å¾µèµ·ä¼çš„å¤©éš›ç·š */
            --bg-field: #fffaf0;
            --bg-tool: #1a202c;
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-sky: #0ea5e9; /* å¤©ç©ºè— */
            --accent-danger: #ef4444; /* è­¦ç¤ºç´… */
            --border-color: #cbd5e1;
            --tech-green: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-sky);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-sky); color: #0284c7; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-danger); color: #b91c1c; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 20px;
            border: 1px solid #334155;
        }
        .tool-panel h2 { border-color: var(--tech-green); color: var(--tech-green); }

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* æ•¸å­¸å¡ç‰‡ */
        .math-card {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--accent-sky);
            font-family: "Times New Roman", serif;
            font-style: italic;
            font-size: 24px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥ä»‹é¢ */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: #94a3b8; }
        input {
            width: 100%; padding: 12px; background: #1e293b; border: 1px solid #475569;
            color: white; border-radius: 6px; font-size: 18px; font-family: 'Consolas', monospace;
        }
        input:focus { outline: 2px solid var(--accent-sky); border-color: transparent; }

        .btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white; border: none; padding: 15px;
            font-size: 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }

        /* è¡¨æ ¼çµæœ */
        .table-container {
            max-height: 350px; overflow-y: auto; margin-top: 20px;
            border: 1px solid #334155; border-radius: 8px;
        }
        table { width: 100%; border-collapse: collapse; font-family: 'Consolas', monospace; font-size: 16px; }
        th { background: #334155; color: #cbd5e1; padding: 10px; text-align: left; position: sticky; top: 0; }
        td { padding: 10px; border-bottom: 1px solid #334155; color: #e2e8f0; }
        tr:nth-child(even) { background: #1e293b; }
        .highlight { color: var(--tech-green); font-weight: bold; }
        .low-point { color: var(--accent-danger); font-weight: bold; background: rgba(239, 68, 68, 0.1); }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 08: è±æ›²ç·šèˆ‡è¶…é«˜ â€” èˆ’é©åº¦çš„ç§˜å¯†</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Road to Expert: ç‚ºä»€éº¼é–‹è»Šéæ©‹ä¸æœƒé£›èµ·ä¾†ï¼Ÿç‚ºä»€éº¼è½‰å½æ™‚å’–å•¡ä¸æœƒç‘å‡ºä¾†ï¼Ÿç­”æ¡ˆåœ¨æ‹‹ç‰©ç·šè£¡ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>â˜• ç›´è§€è­¬å–»ï¼šå’–å•¡æ¯æ¸¬è©¦</h2>
        <p><strong>è±æ›²ç·š (Vertical Curve)</strong> çš„å¥½å£ï¼Œå–æ±ºæ–¼ä¸€æ¯æ”¾åœ¨å„€è¡¨æ¿ä¸Šçš„å’–å•¡ã€‚</p>
        <p>1. <strong>å‡¸æ›²ç·š (Crest)ï¼š</strong> å¦‚æœè»Šå­é–‹åˆ°æœ€é«˜é»æ™‚ï¼Œä½ çš„å±è‚¡é›¢é–‹åº§æ¤…ï¼ˆå¤±é‡ï¼‰ï¼Œå’–å•¡é£›èµ·ä¾†ï¼Œä»£è¡¨æ›²ç·šåŠå¾‘å¤ªå°ï¼ˆKå€¼å¤ªä½ï¼‰ã€‚
        <br>2. <strong>å‡¹æ›²ç·š (Sag)ï¼š</strong> å¦‚æœè»Šå­é–‹åˆ°è°·åº•æ™‚ï¼Œä½ æ„Ÿè¦ºè¢«é‡å£“åœ¨æ¤…å­ä¸Šï¼Œæ‡¸åŠç³»çµ±ç™¼å‡ºå“€è™Ÿï¼ŒåŒæ¨£æ˜¯ä¸åˆæ ¼çš„è¨­è¨ˆã€‚</p>
        <p>æˆ‘å€‘ä½¿ç”¨ã€Œæ‹‹ç‰©ç·šã€ä¾†é€£æ¥å…©å€‹å¡åº¦ï¼Œç›®çš„æ˜¯è®“å‚ç›´åŠ é€Ÿåº¦ï¼ˆGåŠ›ï¼‰ä¿æŒæ†å®šä¸”å¾®å°ï¼Œè®“ä¹˜å®¢æ„Ÿè¦ºä¸åˆ°å¡åº¦çš„è®ŠåŒ–ã€‚</p>

        <h2>ğŸ“‰ è¦–è¦ºåœ–è§£ï¼šæ‹‹ç‰©ç·šèˆ‡å¡åº¦å·®</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg">
                <line x1="50" y1="300" x2="750" y2="300" stroke="#f1f5f9" stroke-width="1"/>

                <line x1="100" y1="250" x2="400" y2="100" stroke="#94a3b8" stroke-width="2" stroke-dasharray="5"/> <line x1="400" y1="100" x2="700" y2="250" stroke="#94a3b8" stroke-width="2" stroke-dasharray="5"/> <circle cx="400" cy="100" r="5" fill="#ef4444"/>
                <text x="400" y="80" text-anchor="middle" font-weight="bold" fill="#ef4444">PVI (äº¤é»)</text>
                <text x="200" y="160" fill="#64748b" transform="rotate(-26 200,160)">g1 = +3%</text>
                <text x="600" y="160" fill="#64748b" transform="rotate(26 600,160)">g2 = -3%</text>

                <path d="M 100 250 Q 400 175 700 250" fill="none" stroke="#0ea5e9" stroke-width="4"/>
                
                <circle cx="100" cy="250" r="5" fill="#0ea5e9"/>
                <text x="100" y="280" text-anchor="middle" font-weight="bold" fill="#0ea5e9">BVC (èµ·é»)</text>

                <circle cx="700" cy="250" r="5" fill="#0ea5e9"/>
                <text x="700" y="280" text-anchor="middle" font-weight="bold" fill="#0ea5e9">EVC (çµ‚é»)</text>

                <line x1="400" y1="100" x2="400" y2="175" stroke="#333" stroke-width="1"/>
                <text x="410" y="140" font-size="14">åç§»é‡ m</text>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šè±æ›²ç·šæ˜¯ä¸€æ¢äºŒæ¬¡æ‹‹ç‰©ç·šã€‚å®ƒçš„ç‰¹æ€§æ˜¯æ¯ä¸€å…¬å°ºçš„å¡åº¦è®ŠåŒ–ç‡ (r) æ˜¯å›ºå®šçš„ã€‚</p>
        </div>

        <h2>ğŸ§® ç¡¬æ ¸ç†è«–ï¼šæ‹‹ç‰©ç·šæ–¹ç¨‹å¼</h2>
        <p>è±æ›²ç·šçš„æ•¸å­¸æ¨¡å‹ç‚º $Y = ax^2 + bx + c$ã€‚åœ¨å·¥ç¨‹ä¸Šï¼Œæˆ‘å€‘é€™æ¨£å®šç¾©ï¼š</p>
        <div class="math-card">
            Y_x = Y_{BVC} + g_1 x + \frac{r}{2}x^2
        </div>
        <ul>
            <li>$x$: è·é›¢ BVC çš„æ°´å¹³è·é›¢ã€‚</li>
            <li>$g_1$: å…¥å£å¡åº¦ (ä¾‹å¦‚ +0.03)ã€‚</li>
            <li>$r$: å¡åº¦è®ŠåŒ–ç‡ (Rate of Change), $r = \frac{g_2 - g_1}{L}$ã€‚</li>
            <li>$L$: æ›²ç·šæ°´å¹³é•·åº¦ã€‚</li>
        </ul>

        <p><strong>æœ€é«˜/æœ€ä½é»åœ¨å“ªï¼Ÿ</strong>
        <br>é€™æ˜¯æ–½å·¥æœ€é‡è¦çš„é»ï¼ˆå› ç‚ºé€™è£¡ä¸æ’æ°´ï¼ï¼‰ã€‚ä»¤ä¸€æ¬¡å¾®åˆ†ç‚º 0ï¼š
        <br>$x_{vertex} = - \frac{g_1}{r}$</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šæ°´çš„è©›å’’</h2>
            
            <h3>1. 0% å¡åº¦çš„æ­»äº¡é™·é˜±</h3>
            <p>åœ¨å‡¹å½¢è±æ›²ç·šçš„æœ€ä½é»ï¼Œæˆ–æ˜¯è¶…é«˜è½‰æ›ï¼ˆå¾å·¦é«˜å³ä½è®Šæˆå·¦ä½å³é«˜ï¼‰çš„ç¬é–“ï¼Œæœƒæœ‰ä¸€å€‹å€åŸŸçš„<strong>å¡åº¦ç‚º 0%</strong>ã€‚</p>
            <p><strong>ç¾å ´éµå‰‡ï¼š</strong>
            <br>çµ•å°ä¸èƒ½è®“ã€Œè±æ›²ç·šçš„æœ€ä½é»ã€å’Œã€Œè¶…é«˜è½‰æ›çš„ 0% æ–·é¢ã€é‡ç–Šï¼
            <br>å¦‚æœé€™å…©å€‹é»ç¢°åœ¨ä¸€èµ·ï¼Œé‚£è£¡å°±æœƒå½¢æˆä¸€å€‹æ°¸é ä¹¾ä¸äº†çš„ã€Œäººå·¥æ¹–ã€ï¼Œè»Šè¼›ç¶“éå¿…å®šæ°´æ¼‚å¤±æ§ã€‚æ¸¬é‡ä¸»ä»»å¿…é ˆåœ¨æ”¾æ¨£å‰ï¼ŒæŠŠé«˜ç¨‹è¡¨æ‹¿ä¾†å°ç…§é€™å…©å€‹é—œéµé»çš„ä½ç½®ã€‚</p>

            <h3>2. æ©‹é¢é«˜ç¨‹æª¢æ ¸</h3>
            <p>æ©‹æ¢é€šå¸¸æ¯ 2-5 å…¬å°ºå°±ç®—ä¸€å€‹æ–·é¢ã€‚
            <br><strong>ä¸è¦åªçœ‹è¨­è¨ˆåœ–çš„é«˜ç¨‹è¡¨ï¼</strong> è‡ªå·±ç”¨å…¬å¼ç®—ä¸€éã€‚ç‚ºä»€éº¼ï¼Ÿå› ç‚ºè¨­è¨ˆå–®ä½çš„ Excel å¶çˆ¾æœƒæ‹‰éŒ¯æ ¼ï¼Œæˆ–è€…åœ¨å°æ•¸é»é€²ä½ä¸Šæœ‰èª¤å·®ã€‚ä½ çš„ JavaScript è¨ˆç®—æ©Ÿæ˜¯æœ€å¾Œä¸€é“é˜²ç·šã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸ“‰ äº’å‹•å·¥å…·ï¼šè±æ›²ç·šé«˜ç¨‹è¨ˆç®—æ©Ÿ</h2>
            <p>è¼¸å…¥ PVI è³‡æ–™ï¼Œè‡ªå‹•è§£ç®—ä»»æ„é»é«˜ç¨‹èˆ‡æ¥µå€¼é»ä½ç½®ã€‚</p>
            
            <div class="input-grid">
                <div>
                    <label>PVI æ¨è™Ÿ (Station)</label>
                    <input type="number" id="pviSta" value="2500">
                </div>
                <div>
                    <label>PVI é«˜ç¨‹ (Elev m)</label>
                    <input type="number" id="pviElev" value="100.000">
                </div>
            </div>

            <div class="input-grid">
                <div>
                    <label>å…¥å£å¡åº¦ g1 (%)</label>
                    <input type="number" id="g1" value="2.5" placeholder="+ä¸Šå¡ -ä¸‹å¡">
                </div>
                <div>
                    <label>å‡ºå£å¡åº¦ g2 (%)</label>
                    <input type="number" id="g2" value="-1.5">
                </div>
            </div>

            <div class="input-grid">
                <div>
                    <label>æ›²ç·šé•·åº¦ L (m)</label>
                    <input type="number" id="L" value="200">
                </div>
                <div>
                    <label>è¨ˆç®—é–“è· (m)</label>
                    <input type="number" id="interval" value="20">
                </div>
            </div>

            <button class="btn" onclick="calcVerticalCurve()">ğŸ“ è¨ˆç®—é«˜ç¨‹è¡¨</button>

            <div class="table-container" id="result-container" style="display:none;">
                <table id="result-table">
                    <thead>
                        <tr>
                            <th>æ¨è™Ÿ</th>
                            <th>x (è·èµ·é»)</th>
                            <th>é«˜ç¨‹ (Elev)</th>
                            <th>å‚™è¨»</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script>
    function formatStation(val) {
        let k = Math.floor(val / 1000);
        let m = val % 1000;
        return `${k}k+${m.toFixed(2).padStart(6, '0')}`;
    }

    function calcVerticalCurve() {
        const pviSta = parseFloat(document.getElementById('pviSta').value);
        const pviElev = parseFloat(document.getElementById('pviElev').value);
        const g1_percent = parseFloat(document.getElementById('g1').value);
        const g2_percent = parseFloat(document.getElementById('g2').value);
        const L = parseFloat(document.getElementById('L').value);
        const interval = parseFloat(document.getElementById('interval').value);

        if ([pviSta, pviElev, g1_percent, g2_percent, L, interval].some(isNaN)) {
            alert("è«‹è¼¸å…¥å®Œæ•´åƒæ•¸ï¼");
            return;
        }

        // è½‰æ›å¡åº¦ç‚ºå°æ•¸
        const g1 = g1_percent / 100;
        const g2 = g2_percent / 100;

        // 1. è¨ˆç®—å¹¾ä½•åƒæ•¸
        const bvcSta = pviSta - L / 2;
        const evcSta = pviSta + L / 2;
        
        // BVC é«˜ç¨‹ = PVI é«˜ç¨‹ - g1 * (L/2)
        const bvcElev = pviElev - g1 * (L / 2);

        // å¡åº¦è®ŠåŒ–ç‡ r = (g2 - g1) / L
        const r = (g2 - g1) / L;

        // æ¥µå€¼é»ä½ç½® (x from BVC)
        // g1 + r*x = 0 => x = -g1 / r
        let x_vertex = -g1 / r;
        let vertexSta = bvcSta + x_vertex;
        let hasVertex = (x_vertex > 0 && x_vertex < L);

        // 2. ç”Ÿæˆé»ä½
        let points = [];
        points.push({sta: bvcSta, type: 'BVC'});
        
        // æ•´æ¨
        let curr = Math.ceil(bvcSta / interval) * interval;
        if (curr <= bvcSta) curr += interval;
        while (curr < evcSta) {
            points.push({sta: curr, type: ''});
            curr += interval;
        }
        
        // åŠ å…¥æ¥µå€¼é» (å¦‚æœæœ‰çš„è©±)
        if (hasVertex) {
            points.push({sta: vertexSta, type: (r < 0 ? 'HIGH' : 'LOW')});
        }
        
        points.push({sta: evcSta, type: 'EVC'});

        // æ’åº
        points.sort((a, b) => a.sta - b.sta);
        
        // å»é‡ (å¦‚æœæœ‰æ¥µå€¼é»å‰›å¥½åœ¨æ•´æ¨ä¸Š)
        points = points.filter((item, pos, ary) => {
            return !pos || item.sta !== ary[pos - 1].sta;
        });

        // 3. è¨ˆç®—ä¸¦é¡¯ç¤º
        const tbody = document.getElementById('result-table').querySelector('tbody');
        tbody.innerHTML = "";

        points.forEach(p => {
            let x = p.sta - bvcSta;
            // æ‹‹ç‰©ç·šå…¬å¼ Y = Y_bvc + g1*x + (r/2)*x^2
            let y = bvcElev + g1 * x + (r / 2) * x * x;
            
            let row = document.createElement('tr');
            let noteClass = '';
            if (p.type === 'BVC' || p.type === 'EVC') noteClass = 'highlight';
            if (p.type === 'HIGH' || p.type === 'LOW') noteClass = 'low-point';

            row.innerHTML = `
                <td>${formatStation(p.sta)}</td>
                <td>${x.toFixed(2)}</td>
                <td style="font-weight:bold; color:#0ea5e9;">${y.toFixed(4)}</td>
                <td class="${noteClass}">${p.type}</td>
            `;
            tbody.appendChild(row);
        });

        document.getElementById('result-container').style.display = 'block';
    }
</script>
<!-- NAV SCRIPT START -->
<script>
(function(){
    // è‡ªå‹•ç”Ÿæˆå°è¦½æŒ‰éˆ•
    const total=13; // ç¸½èª²æ•¸
    const page=location.pathname.split("/").pop();
    const num=parseInt(page.match(/lesson(\d+)\.html/i)?.[1]||0);
    if(!num)return;
    
    const prev=num>1?`lesson${String(num-1).padStart(2,'0')}.html`:'index.html';
    const next=num<total?`lesson${String(num+1).padStart(2,'0')}.html`:'#';
    const bg='#0f172a'; const color='white';

    const div=document.createElement('div');
    div.style.cssText="position:fixed;bottom:20px;right:20px;display:flex;gap:10px;z-index:9999;font-family:Consolas,monospace;";
    div.innerHTML=`
        <a href="${prev}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">â† PREV</a>
        <a href="index.html" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">MENU</a>
        <a href="${next}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;opacity:${num>=total?0.5:1};pointer-events:${num>=total?'none':'auto'}">NEXT â†’</a>
    `;
    document.body.appendChild(div);
})();
</script>
<!-- NAV SCRIPT END -->
</body>

</html>
