<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 11: æ•¸æ“šçš„ç…‰é‡‘è¡“â€”â€”Python è‡ªå‹•åŒ–æ‰¹æ¬¡è™•ç†</title>
    <style>
        :root {
            --bg-theory: #f0fdfa; /* æ•¸æ“šæµçš„é’è‰² */
            --bg-field: #fffaf0;
            --bg-tool: #1e1e1e; /* VS Code é¢¨æ ¼æ·±è‰² */
            --text-main: #334155;
            --text-light: #d4d4d4;
            --accent-py: #3776ab; /* Python è— */
            --accent-lib: #eab308; /* Python é»ƒ */
            --border-color: #cbd5e1;
            --code-font: 'Fira Code', 'Consolas', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-py);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-py); color: #0f766e; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-lib); color: #b45309; }

        /* å·¥å…·é¢æ¿ (æ¨¡æ“¬ IDE) */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 0;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
            position: sticky;
            top: 20px;
            border: 1px solid #333;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .ide-header {
            background: #2d2d2d;
            padding: 10px 20px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ide-title { font-family: var(--code-font); font-size: 14px; color: #9cdcfe; }
        
        .ide-content {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        /* ç¨‹å¼ç¢¼å€å¡Š */
        pre {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: var(--code-font);
            font-size: 14px;
            color: #d4d4d4;
            border: 1px solid #444;
        }
        .keyword { color: #569cd6; } /* def, import */
        .function { color: #dcdcaa; } /* print */
        .string { color: #ce9178; } /* "text" */
        .comment { color: #6a9955; } /* # comment */

        /* CSV æ¨¡æ“¬å€ */
        textarea {
            width: 100%;
            height: 150px;
            background: #252526;
            color: #d4d4d4;
            border: 1px solid #444;
            padding: 10px;
            font-family: var(--code-font);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .btn {
            background: #3776ab;
            color: white; border: none; padding: 10px 20px;
            font-size: 16px; border-radius: 4px; cursor: pointer; font-weight: bold;
            font-family: var(--code-font);
            transition: background 0.2s;
        }
        .btn:hover { background: #2b5b84; }

        .output-console {
            background: #000;
            border: 1px solid #333;
            padding: 15px;
            font-family: var(--code-font);
            font-size: 13px;
            color: #cccccc;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .log-info { color: #4ade80; }
        .log-err { color: #f87171; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 11: æ•¸æ“šçš„ç…‰é‡‘è¡“ â€” Python è‡ªå‹•åŒ–æ‰¹æ¬¡è™•ç†</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Masters Program: ç•¶æ•¸æ“šé‡è¶…éä¸€è¬ç­†æ™‚ï¼Œæ»‘é¼ æ˜¯ç„¡ç”¨çš„ã€‚ä½ éœ€è¦çš„æ˜¯ç¨‹å¼ç¢¼çš„è¿´åœˆ (Loop)ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸ­ ç›´è§€è­¬å–»ï¼šæ•¸æ“šå·¥å» çš„è¼¸é€å¸¶</h2>
        <p>å¦‚æœ Excel æ˜¯ã€Œæ‰‹å·¥è—ã€ï¼Œæ¯ä¸€è¡Œéƒ½è¦ä½ è¦ªæ‰‹èª¿æ•´ï¼›é‚£éº¼ Python å°±æ˜¯ã€Œè‡ªå‹•åŒ–æµæ°´ç·šã€ã€‚</p>
        <p>æƒ³åƒä½ æœ‰ 10,000 é¡†å¾…åˆ†é¡çš„è˜‹æœï¼ˆæ¸¬é»æ•¸æ“šï¼‰ï¼š
        <br>1. <strong>Pandas (åœ–æ›¸é¤¨å“¡)ï¼š</strong> è² è²¬æŠŠäº‚ä¸ƒå…«ç³Ÿçš„æ•¸æ“šæ•´ç†æˆä¹¾æ·¨çš„è¡¨æ ¼ (DataFrame)ã€‚
        <br>2. <strong>Regex (ç¯©é¸ç¶²)ï¼š</strong> å°±åƒè¨­ä¸‹äº†ç‰¹å®šå½¢ç‹€çš„æ¿¾ç¶²ï¼Œå°ˆé–€æŠ“å–é‚£äº›é•·å¾—åƒåæ¨™çš„å­—ä¸²ï¼Œéæ¿¾æ‰é›œè¨Šã€‚
        <br>3. <strong>Loop (æ©Ÿå™¨æ‰‹è‡‚)ï¼š</strong> ä¸çŸ¥ç–²å€¦åœ°å°æ¯ä¸€è¡ŒåŸ·è¡Œç›¸åŒçš„è¨ˆç®—å…¬å¼ï¼Œé€Ÿåº¦æ˜¯äººé¡çš„ 1000 å€ã€‚</p>

        <h2>ğŸ è¦–è¦ºåœ–è§£ï¼šETL æµç¨‹ (Extract, Transform, Load)</h2>
        <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center;">
             <svg viewBox="0 0 800 250" xmlns="http://www.w3.org/2000/svg">
                <path d="M 50 50 L 150 50 L 150 150 L 50 150 Z" fill="#e2e8f0" stroke="#333" stroke-width="2"/>
                <text x="100" y="90" text-anchor="middle" font-weight="bold">RAW Files</text>
                <text x="100" y="110" text-anchor="middle" font-size="12" fill="#64748b">.GSI / .SDR / .CSV</text>

                <path d="M 160 100 L 240 100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                <rect x="250" y="30" width="300" height="140" fill="#f0fdfa" stroke="#0f766e" stroke-width="2" rx="10"/>
                <text x="400" y="60" text-anchor="middle" font-weight="bold" fill="#0f766e">Python Script (The Engine)</text>
                
                <rect x="270" y="80" width="80" height="40" fill="#3776ab" rx="4"/>
                <text x="310" y="105" text-anchor="middle" fill="white" font-size="12">Regex è§£æ</text>
                
                <rect x="360" y="80" width="80" height="40" fill="#eab308" rx="4"/>
                <text x="400" y="105" text-anchor="middle" fill="black" font-size="12">Pandas æ¸…æ´—</text>
                
                <rect x="450" y="80" width="80" height="40" fill="#10b981" rx="4"/>
                <text x="490" y="105" text-anchor="middle" fill="white" font-size="12">Numpy è¨ˆç®—</text>

                <path d="M 560 100 L 640 100" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                <path d="M 650 50 L 750 50 L 750 150 L 650 150 Z" fill="#dbeafe" stroke="#333" stroke-width="2"/>
                <text x="700" y="90" text-anchor="middle" font-weight="bold">Clean Report</text>
                <text x="700" y="110" text-anchor="middle" font-size="12" fill="#64748b">.XLSX / .HTML</text>

                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="7" refY="3" orient="auto">
                        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                    </marker>
                </defs>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šPython æ˜¯ä¸­é–“çš„é»‘ç›’å­ã€‚ä¸ç®¡è¼¸å…¥æ ¼å¼å¤šäº‚ï¼Œè¼¸å‡ºçš„æ°¸é æ˜¯æ¨™æº–åŒ–çš„æˆæœã€‚</p>
        </div>

        <h2>ğŸ’» ç¡¬æ ¸ç†è«–ï¼šæ­£è¦è¡¨ç¤ºæ³• (Regex)</h2>
        <p>å…¨ç«™å„€åŸå§‹æ•¸æ“šé€šå¸¸é•·é€™æ¨£ï¼š<br>
        <code>110001+00000TP1 31..00+00123456 81..00+...</code></p>
        <p>é€™ä¸æ˜¯çµ¦äººçœ‹çš„ï¼Œæ˜¯çµ¦æ©Ÿå™¨çœ‹çš„ã€‚è¦æå–å…¶ä¸­çš„æ•¸æ“šï¼Œæˆ‘å€‘ä¸èƒ½ç”¨ã€Œç¬¬å¹¾å€‹å­—ã€ï¼Œå› ç‚ºé•·åº¦æœƒè®Šã€‚æˆ‘å€‘å¿…é ˆä½¿ç”¨ **Regex (Regular Expression)**ã€‚</p>
        <ul>
            <li><code>\d+</code>ï¼šåŒ¹é…ä»»æ„æ•¸å­—ã€‚</li>
            <li><code>TP\d+</code>ï¼šåŒ¹é… "TP" é–‹é ­æ¥æ•¸å­—çš„é»è™Ÿã€‚</li>
            <li><code>(?&lt;=31..00\+)\d+</code>ï¼š(Lookbehind) å°‹æ‰¾ "31..00+" å¾Œé¢çš„æ•¸å­—ï¼ˆé€šå¸¸æ˜¯æ°´å¹³è§’ï¼‰ã€‚</li>
        </ul>
        <p>å­¸æœƒ Regexï¼Œä½ å°±æ“æœ‰äº†åœ¨æ•¸ç™¾è¬å­—å…ƒä¸­ç¬é–“æ‰¾åˆ°ç›®æ¨™çš„ã€Œä¸Šå¸ä¹‹çœ¼ã€ã€‚</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šGIGO åŸå‰‡</h2>
            
            <h3>1. Garbage In, Garbage Out</h3>
            <p>ç¨‹å¼è·‘å¾—å†å¿«ï¼Œå¦‚æœè¼¸å…¥çš„åŸå§‹æª”æœ‰éŒ¯ï¼Œè¼¸å‡ºçš„å°±æ˜¯ä¸€å †å»¢ç‰©ã€‚
            <br><strong>è‡ªå‹•åŒ–çš„é™·é˜±ï¼š</strong> æ‰¹æ¬¡è™•ç†æœƒè®“ä½ æ‡¶å¾—çœ‹æ•¸æ“šã€‚ä»¥å‰æ‰‹ç®—æ™‚ï¼Œä½ æœƒç™¼ç¾ã€Œå’¦ï¼Ÿé€™å€‹è·é›¢ 5000 ç±³æ€ªæ€ªçš„ã€ã€‚ç¾åœ¨ç¨‹å¼ä¸€ç§’è·‘å®Œï¼Œä½ å¯èƒ½ç›´æ¥å°±æŠŠéŒ¯èª¤çš„å ±è¡¨äº¤å‡ºå»äº†ã€‚
            <br><strong>è§£æ³•ï¼š</strong> åœ¨ Python è…³æœ¬ä¸­åŠ å…¥ã€Œæ–·è¨€ (Assert)ã€æˆ–ã€Œé–¾å€¼æª¢æŸ¥ã€ã€‚ä¾‹å¦‚ï¼š<code>if dist > 1000: print("è­¦å‘Šï¼šè¶…é•·è·é›¢")</code>ã€‚</p>

            <h3>2. å‚™ä»½åŸå§‹æª”</h3>
            <p>æ°¸é ä¸è¦ç›´æ¥å°åŸå§‹æª”é€²è¡Œå¯«å…¥æ“ä½œã€‚Python è…³æœ¬çš„ç¬¬ä¸€æ­¥æ°¸é æ˜¯ <code>read</code>ï¼Œæœ€å¾Œä¸€æ­¥æ˜¯ <code>to_csv('new_file.csv')</code>ã€‚ä¿ç•™æœ€åŸå§‹çš„ Raw Dataï¼Œæ˜¯ä½ ä¿å‘½çš„æœ€å¾Œé˜²ç·šã€‚</p>
        </div>

        <div class="tool-panel">
            <div class="ide-header">
                <span class="ide-title">main.py - Python Data Processor (Simulated)</span>
                <span style="font-size:12px; color:#6a9955;">â— Connected</span>
            </div>
            
            <div class="ide-content">
                <div style="margin-bottom: 10px;">
                    <label style="color:#d4d4d4; font-size:14px;">1. Python æ ¸å¿ƒè…³æœ¬ (è«‹è¤‡è£½å›æœ¬æ©ŸåŸ·è¡Œ)</label>
                    <pre><span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="comment"># æ¨¡æ“¬: è¨ˆç®—åæ¨™ (Batch Processing)</span>
<span class="keyword">def</span> <span class="function">calculate_coords</span>(df):
    <span class="comment"># å‘é‡åŒ–è¨ˆç®—: é€Ÿåº¦æ˜¯ for loop çš„ç™¾å€</span>
    rads = np.deg2rad(df[<span class="string">'Azimuth'</span>])
    df[<span class="string">'dN'</span>] = df[<span class="string">'Dist'</span>] * np.cos(rads)
    df[<span class="string">'dE'</span>] = df[<span class="string">'Dist'</span>] * np.sin(rads)
    <span class="keyword">return</span> df

<span class="comment"># ä¸»ç¨‹å¼</span>
<span class="keyword">def</span> <span class="function">main</span>(csv_file):
    df = pd.read_csv(csv_file)
    <span class="function">print</span>(<span class="string">f"Loaded {len(df)} points."</span>)
    
    <span class="comment"># æ¸…æ´—æ•¸æ“š: å»é™¤è·é›¢ç‚º 0 çš„å™ªé»</span>
    df = df[df[<span class="string">'Dist'</span>] > <span class="keyword">0</span>]
    
    result = calculate_coords(df)
    result.to_csv(<span class="string">'report.csv'</span>)
    <span class="function">print</span>(<span class="string">"Processing Complete."</span>)</pre>
                </div>

                <div>
                    <label style="color:#d4d4d4; font-size:14px;">2. ç·šä¸Šæ¨¡æ“¬å™¨ (JS Engine)</label>
                    <p style="font-size:12px; color:#64748b; margin-bottom:5px;">è²¼ä¸Š CSV æ ¼å¼æ•¸æ“šï¼šé»è™Ÿ, æ–¹ä½è§’(åº¦), è·é›¢(m)</p>
                    <textarea id="csv-input">TP1, 45.0, 100.0
TP2, 135.0, 50.5
TP3, 0.0, 0
TP4, 90.0, 200.0
BadPoint, 0, -10</textarea>
                    
                    <button class="btn" onclick="runBatchProcess()">â–¶ Run Batch Process</button>
                </div>

                <div>
                    <label style="color:#d4d4d4; font-size:14px;">Terminal Output</label>
                    <div id="console" class="output-console">> Waiting for input...</div >
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function runBatchProcess() {
        const input = document.getElementById('csv-input').value;
        const consoleDiv = document.getElementById('console');
        
        consoleDiv.innerHTML = "> Initializing Python Simulator...\n";
        
        // æ¨¡æ“¬å»¶é²
        setTimeout(() => {
            try {
                // 1. è§£æ CSV (Parsing)
                const lines = input.trim().split('\n');
                consoleDiv.innerHTML += `<span class="log-info">[INFO] Loaded ${lines.length} lines.</span>\n`;
                
                let processedData = [];
                let errorCount = 0;

                consoleDiv.innerHTML += "> Starting Data Cleaning & Calculation...\n";

                // 2. æ¨¡æ“¬ Pandas DataFrame è™•ç†
                lines.forEach((line, index) => {
                    const cols = line.split(',').map(s => s.trim());
                    
                    if(cols.length < 3) return; // Skip invalid

                    const id = cols[0];
                    const az = parseFloat(cols[1]);
                    const dist = parseFloat(cols[2]);

                    // æ•¸æ“šæ¸…æ´—é‚è¼¯
                    if (isNaN(az) || isNaN(dist)) {
                        consoleDiv.innerHTML += `<span class="log-err">[WARN] Line ${index+1}: Invalid Number format. Dropped.</span>\n`;
                        errorCount++;
                        return;
                    }

                    if (dist <= 0) {
                        consoleDiv.innerHTML += `<span class="log-err">[WARN] Line ${index+1}: Distance <= 0 (${dist}). Dropped (Noise).</span>\n`;
                        errorCount++;
                        return;
                    }

                    // å‘é‡è¨ˆç®—æ¨¡æ“¬
                    const rad = az * (Math.PI / 180);
                    const dN = dist * Math.cos(rad);
                    const dE = dist * Math.sin(rad);

                    processedData.push({
                        id: id,
                        n: dN.toFixed(3),
                        e: dE.toFixed(3)
                    });
                });

                // 3. è¼¸å‡ºå ±å‘Š
                consoleDiv.innerHTML += "------------------------------------------------\n";
                consoleDiv.innerHTML += `ID\t\tNorth(dN)\tEast(dE)\n`;
                consoleDiv.innerHTML += "------------------------------------------------\n";
                
                processedData.forEach(d => {
                    consoleDiv.innerHTML += `${d.id}\t\t${d.n}\t\t${d.e}\n`;
                });

                consoleDiv.innerHTML += "------------------------------------------------\n";
                consoleDiv.innerHTML += `<span class="log-info">[SUCCESS] Exported ${processedData.length} clean points.</span>\n`;
                if(errorCount > 0) {
                    consoleDiv.innerHTML += `<span class="log-err">[SUMMARY] Removed ${errorCount} bad records.</span>\n`;
                }

            } catch (e) {
                consoleDiv.innerHTML += `<span class="log-err">[CRITICAL ERROR] ${e.message}</span>`;
            }
        }, 800);
    }
</script>

</body>
</html>