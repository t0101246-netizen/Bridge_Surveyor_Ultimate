<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 12: é»é›²çš„é›•åˆ»å¸«â€”â€”3D é€†å‘å·¥ç¨‹ (LiDAR)</title>
    <style>
        :root {
            --bg-theory: #ecfccb; /* è¢å…‰ç¶ èƒŒæ™¯ï¼Œè±¡å¾µé›·å°„ */
            --bg-field: #fffaf0;
            --bg-tool: #000000; /* å…¨é»‘ç•«å¸ƒ */
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-laser: #65a30d; /* é›·å°„ç¶  */
            --accent-code: #a3e635; /* ç¨‹å¼ç¢¼é«˜äº® */
            --border-color: #cbd5e1;
            --tech-font: 'Fira Code', 'Consolas', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-laser);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-laser); color: #365314; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: #b45309; color: #b45309; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
            position: sticky;
            top: 20px;
            border: 1px solid #333;
        }
        .tool-panel h2 { color: var(--accent-code); text-transform: uppercase; letter-spacing: 2px; }

        /* Python Code Block */
        .code-block {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: var(--tech-font);
            font-size: 14px;
            color: #d4d4d4;
            border: 1px solid #444;
            margin-bottom: 20px;
        }
        .kw { color: #569cd6; } /* keyword */
        .fn { color: #dcdcaa; } /* function */
        .str { color: #ce9178; } /* string */
        .com { color: #6a9955; } /* comment */

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* Canvas Simulator */
        canvas {
            background: #111;
            border: 1px solid #444;
            border-radius: 4px;
            cursor: crosshair;
            display: block;
            margin: 0 auto;
        }

        .controls {
            display: flex; gap: 10px; margin-top: 15px;
        }
        
        .btn {
            background: #3f6212;
            color: white; border: none; padding: 10px 15px;
            font-size: 16px; border-radius: 4px; cursor: pointer; font-weight: bold;
            font-family: var(--tech-font); flex: 1;
            transition: background 0.2s;
        }
        .btn:hover { background: #4d7c0f; }
        .btn-reset { background: #333; }
        
        .stat-display {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;
            font-family: var(--tech-font); font-size: 14px; color: #aaa;
        }
        .stat-val { color: var(--accent-code); font-weight: bold; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 12: é»é›²çš„é›•åˆ»å¸« â€” 3D é€†å‘å·¥ç¨‹</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Masters Program: é›»è…¦çœ‹è¦‹çš„ä¸æ˜¯æ©‹ï¼Œæ˜¯ä¸€åœ˜æ•¸ç™¾è¬å€‹æ¼‚æµ®åœ¨ç©ºä¸­çš„åº§æ¨™é»ã€‚ä½ å¿…é ˆè³¦äºˆå®ƒå€‘æ„ç¾©ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸ ç›´è§€è­¬å–»ï¼šèœœèœ‚ç¾¤èˆ‡é›•åƒ</h2>
        <p>æƒ³åƒä¸€åº§éš±å½¢çš„æ©‹æ¨‘ï¼Œä¸Šé¢åœæ»¿äº†å¯†å¯†éº»éº»çš„è¢ç«èŸ²ï¼ˆé»é›² Point Cloudï¼‰ã€‚
        <br>åœ¨é»‘æš—ä¸­ï¼Œä½ ä¾ç¨€çœ‹å¾—å‡ºæ©‹çš„å½¢ç‹€ã€‚ä½†å¦‚æœä½ ä»”ç´°çœ‹ï¼Œæœƒæœ‰å¹¾éš»è¢ç«èŸ²åœ¨æ©‹å¤–äº‚é£›ï¼ˆé›œè¨Š Noiseï¼‰ï¼Œé‚„æœ‰äº›åœ°æ–¹å› ç‚ºå¤ªäº®è€Œçœ‹ä¸æ¸…ï¼ˆå¯†åº¦éé«˜ï¼‰ã€‚</p>
        <p><strong>é€†å‘å·¥ç¨‹ (Reverse Engineering) çš„éç¨‹ï¼š</strong>
        <br>1. <strong>è¶•èµ°äº‚é£›çš„èŸ²ï¼š</strong> çµ±è¨ˆé›¢ç¾¤å€¼ç§»é™¤ (Statistical Outlier Removal)ã€‚
        <br>2. <strong>è®“èŸ²æ’éšŠæ•´é½Šï¼š</strong> é«”ç´ é™æ¡æ¨£ (Voxel Downsampling)ã€‚
        <br>3. <strong>ç”¨å¸ƒæŠŠèŸ²åŒ…èµ·ä¾†ï¼š</strong> æ›²é¢é‡å»º (Surface Reconstruction / Meshing)ï¼Œé€™æ™‚å®ƒæ‰çœŸæ­£è®Šæˆä¸€å€‹å¯¦é«”çš„ã€Œé¢ã€ã€‚</p>

        <h2>ğŸ§Š è¦–è¦ºåœ–è§£ï¼šKD-Tree èˆ‡é«”ç´  (Voxel)</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <rect width="40" height="40" fill="none" stroke="#e2e8f0"/>
                    </pattern>
                </defs>
                <rect x="50" y="50" width="320" height="200" fill="url(#grid)" stroke="#333"/>
                <text x="210" y="280" font-size="14" text-anchor="middle">é«”ç´ ç¶²æ ¼ (Voxel Grid)</text>

                <g id="points">
                    <circle cx="90" cy="90" r="3" fill="#65a30d"/>
                    <circle cx="95" cy="92" r="3" fill="#65a30d"/>
                    <circle cx="88" cy="95" r="3" fill="#65a30d"/>
                    <circle cx="92" cy="88" r="3" fill="#65a30d"/>
                    <circle cx="210" cy="150" r="3" fill="#65a30d"/>
                    <circle cx="215" cy="155" r="3" fill="#65a30d"/>
                </g>

                <path d="M 400 150 L 480 150" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                <rect x="500" y="50" width="200" height="200" fill="none" stroke="#333"/>
                <rect x="500" y="50" width="200" height="200" fill="url(#grid)" opacity="0.5"/>
                
                <circle cx="525" cy="75" r="6" fill="#365314"/> <text x="600" y="150" text-anchor="middle" fill="#666">é™æ¡æ¨£å¾Œ (Downsampled)</text>
                <text x="600" y="170" text-anchor="middle" fill="#666" font-size="12">æ¯æ ¼åªç•™ä¸€å€‹é‡å¿ƒé»</text>

                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="7" refY="3" orient="auto">
                        <path d="M0,0 L0,6 L9,3 z" fill="#333" />
                    </marker>
                </defs>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šç‚ºäº†è™•ç†æ•¸å„„å€‹é»ï¼Œæˆ‘å€‘ç”¨ã€Œé«”ç´ ã€å°‡ç©ºé–“æ–¹æ ¼åŒ–ã€‚åœ¨åŒä¸€å€‹æ ¼å­è£¡çš„ä¸€ç™¾å€‹é»ï¼Œæœ€å¾Œåˆä½µæˆä¸€å€‹ã€Œé‡å¿ƒé»ã€ï¼Œå¤§å¹…æ¸›å°‘é‹ç®—é‡ã€‚</p>
        </div>

        <h2>ğŸ§® ç¡¬æ ¸ç†è«–ï¼šæ³•å‘é‡ (Normal Vector)</h2>
        <p>é»é›²åªæ˜¯ä¸€å † $(x, y, z)$ åæ¨™ï¼Œå®ƒä¸çŸ¥é“å“ªé‚Šæ˜¯ã€Œå¤–é¢ã€ã€‚
        <br>åœ¨é€²è¡Œæ›²é¢é‡å»ºï¼ˆæŠŠé»é€£æˆé¢ï¼‰ä¹‹å‰ï¼Œæˆ‘å€‘å¿…é ˆè¨ˆç®—æ¯å€‹é»çš„<strong>æ³•å‘é‡</strong>ã€‚</p>
        <p><strong>åŸç†ï¼š</strong>
        <br>1. æ‰¾å‡ºæŸé» $P$ é™„è¿‘çš„ $k$ å€‹é„°å±…ã€‚
        <br>2. æ“¬åˆä¸€å€‹ã€Œæœ€ä½³å¹³é¢ã€(PCA - ä¸»æˆåˆ†åˆ†æ)ã€‚
        <br>3. é€™å€‹å¹³é¢çš„å‚ç›´æ–¹å‘ï¼Œå°±æ˜¯æ³•å‘é‡ $\vec{n}$ã€‚</p>
        <p><strong>é™·é˜±ï¼š</strong> å¦‚æœæ³•å‘é‡æ–¹å‘ç®—åäº†ï¼ˆæŒ‡å‘ç‰©é«”å…§éƒ¨ï¼‰ï¼Œé‡å»ºå‡ºä¾†çš„æ¨¡å‹æœƒè®Šæˆé»‘è‰²çš„ç ´æ´ã€‚é€™åœ¨æ©‹å¢©èƒŒé¢æˆ–æ¶µæ´å…§éƒ¨æœ€å¸¸ç™¼ç”Ÿã€‚</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šæƒæçš„æ­»è§’</h2>
            
            <h3>1. æ¿•åœ°èˆ‡é»‘æ´</h3>
            <p>å…‰é”æ˜¯é é›·å°„åå°„ã€‚
            <br>â— <strong>ç©æ°´è·¯é¢ï¼š</strong> åƒé¡å­ä¸€æ¨£æŠŠé›·å°„å½ˆèµ°ï¼ˆé¡é¢åå°„ï¼‰ï¼Œå„€å™¨æ”¶ä¸åˆ°å›æ³¢ï¼Œæ•¸æ“šæœƒå‡ºç¾ã€Œç ´æ´ã€ã€‚
            <br>â— <strong>æ–°é‹ªæŸæ²¹ï¼š</strong> é»‘è‰²å¸å…‰ç‡æ¥µé«˜ï¼Œæƒæè·é›¢æœƒå¤§æ‰“æŠ˜æ‰£ã€‚
            <br><strong>è§£æ³•ï¼š</strong> ä¸‹é›¨å¤©çµ•å°ä¸æƒã€‚é‡åˆ°é»‘è‰²ç‰©é«”ï¼Œå¢åŠ æƒæå¯†åº¦æˆ–è²¼ä¸Šé«˜åå°„æ¨™é¶ã€‚</p>

            <h3>2. æ‹¼æ¥ (Registration) çš„æ‚²åŠ‡</h3>
            <p>ä½ åœ¨æ©‹é ­æƒä¸€ç«™ï¼Œæ©‹å°¾æƒä¸€ç«™ï¼Œå›å»æ€éº¼æ¥èµ·ä¾†ï¼Ÿ
            <br>è»Ÿé«”é›–ç„¶æœ‰ã€Œé›²å°é›²è‡ªå‹•æ‹¼æ¥ã€(Cloud-to-Cloud)ï¼Œä½†å‰ææ˜¯å…©ç«™ä¹‹é–“è¦æœ‰ <strong>30%~50% çš„é‡ç–Šç‡</strong>ã€‚
            <br><strong>è€é³¥æŠ€å·§ï¼š</strong> åœ¨å…©ç«™é‡ç–Šè™•æ”¾ç½®ã€Œæ¨™é¶çƒ (Spheres)ã€ã€‚é€™æ˜¯çµ•å°æ§åˆ¶é»ï¼Œæ¯”è»Ÿé«”è‡ªå‹•é‹ç®—å¯é ä¸€ç™¾å€ã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸ Python å¯¦æˆ°ï¼šOpen3D é™å™ªè…³æœ¬</h2>
            <div class="code-block">
<span class="kw">import</span> open3d <span class="kw">as</span> o3d

<span class="kw">def</span> <span class="fn">process_point_cloud</span>(filename):
    <span class="com"># 1. è®€å–é»é›²</span>
    pcd = o3d.io.read_point_cloud(filename)
    <span class="fn">print</span>(<span class="str">f"åŸå§‹é»æ•¸: {len(pcd.points)}"</span>)

    <span class="com"># 2. é«”ç´ é™æ¡æ¨£ (Voxel Downsample)</span>
    <span class="com"># æ¯ 5cm ä¸€æ ¼ï¼Œå¤§å¹…ç˜¦èº«</span>
    downpcd = pcd.voxel_down_sample(voxel_size=<span class="str">0.05</span>)

    <span class="com"># 3. çµ±è¨ˆé›¢ç¾¤å€¼ç§»é™¤ (SOR Denoise)</span>
    <span class="com"># è¨ˆç®—æ¯å€‹é»èˆ‡é„°å±…çš„å¹³å‡è·é›¢ï¼Œè¶…é 2å€æ¨™æº–å·®è€…è¦–ç‚ºé›œè¨Š</span>
    cl, ind = downpcd.remove_statistical_outlier(nb_neighbors=<span class="str">20</span>, std_ratio=<span class="str">2.0</span>)
    
    clean_pcd = downpcd.select_by_index(ind)
    
    <span class="com"># 4. è¨ˆç®—æ³•å‘é‡</span>
    clean_pcd.estimate_normals()

    <span class="kw">return</span> clean_pcd
            </div>

            <h2>ğŸ§¹ äº’å‹•æ¨¡æ“¬ï¼šé›œè¨Šæ¿¾æ³¢å™¨ (SOR Simulator)</h2>
            <p style="font-size:14px; color:#aaa; margin-bottom:10px;">é»æ“Šã€Œç”Ÿæˆé»é›²ã€ç”¢ç”Ÿæ©‹å¢©èˆ‡é›œè¨Šï¼Œå†é»æ“Šã€ŒåŸ·è¡Œæ¿¾æ³¢ã€è§€å¯Ÿ SOR æ¼”ç®—æ³•å¦‚ä½•é‹ä½œã€‚</p>
            
            <canvas id="lidarCanvas" width="400" height="300"></canvas>
            
            <div class="stat-display">
                <div>åŸå§‹é»æ•¸: <span id="count-raw" class="stat-val">0</span></div>
                <div>å‰©é¤˜é»æ•¸: <span id="count-clean" class="stat-val">--</span></div>
            </div>

            <div class="controls">
                <button class="btn btn-reset" onclick="generateCloud()">1. ç”ŸæˆåŸå§‹é»é›²</button>
                <button class="btn" onclick="applySOR()">2. åŸ·è¡Œ SOR æ¿¾æ³¢</button>
            </div>
        </div>

    </div>
</div>

<script>
    const canvas = document.getElementById('lidarCanvas');
    const ctx = canvas.getContext('2d');
    let points = [];

    // ç”Ÿæˆæ¨¡æ“¬æ•¸æ“š
    function generateCloud() {
        points = [];
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. ç”Ÿæˆ "æ©‹å¢©" (å¯†é›†çµæ§‹)
        for (let i = 0; i < 600; i++) {
            // æ©‹æŸ±ä¸»é«”
            let x = 180 + Math.random() * 40;
            let y = 50 + Math.random() * 200;
            points.push({x: x, y: y, type: 'structure', keep: true});
        }
        
        // æ©‹å¸½
        for (let i = 0; i < 300; i++) {
            let x = 100 + Math.random() * 200;
            let y = 30 + Math.random() * 30;
            points.push({x: x, y: y, type: 'structure', keep: true});
        }

        // 2. ç”Ÿæˆ "é›œè¨Š" (é³¥ã€ç°å¡µã€æ¨¹è‘‰)
        for (let i = 0; i < 150; i++) {
            let x = Math.random() * canvas.width;
            let y = Math.random() * canvas.height;
            points.push({x: x, y: y, type: 'noise', keep: true});
        }

        document.getElementById('count-raw').innerText = points.length;
        document.getElementById('count-clean').innerText = "--";
        drawPoints();
    }

    function drawPoints() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        points.forEach(p => {
            if (!p.keep) {
                ctx.fillStyle = '#ef4444'; // è¢«å‰”é™¤çš„é» (ç´…)
            } else {
                ctx.fillStyle = '#a3e635'; // ä¿ç•™çš„é» (ç¶ )
            }
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
            ctx.fill();
        });
    }

    // æ¨¡æ“¬ SOR (Statistical Outlier Removal) æ¼”ç®—æ³•
    function applySOR() {
        if (points.length === 0) return;

        // ç°¡å–®æ¨¡æ“¬ï¼šè¨ˆç®—æ¯å€‹é»åˆ°æœ€è¿‘é„°å±…çš„è·é›¢
        // çœŸå¯¦ç®—æ³•æœƒè¨ˆç®— k-NN å¹³å‡è·é›¢ä¸¦å»ºç«‹é«˜æ–¯åˆ†ä½ˆ
        
        let distances = [];

        // 1. è¨ˆç®—è·é›¢å ´
        points.forEach((p, idx) => {
            let minDirectDist = 9999;
            points.forEach((other, otherIdx) => {
                if (idx === otherIdx) return;
                let dx = p.x - other.x;
                let dy = p.y - other.y;
                let d = Math.sqrt(dx*dx + dy*dy);
                if (d < minDirectDist) minDirectDist = d;
            });
            p.dist = minDirectDist;
            distances.push(minDirectDist);
        });

        // 2. è¨ˆç®—å¹³å‡å€¼èˆ‡æ¨™æº–å·®
        let sum = distances.reduce((a, b) => a + b, 0);
        let mean = sum / distances.length;
        
        // è¨­å®šé–¾å€¼ (æ¨¡æ“¬ 2å€æ¨™æº–å·®)
        // é€™è£¡ç‚ºäº†è¦–è¦ºæ•ˆæœï¼Œç›´æ¥è¨­å®šä¸€å€‹ç¶“é©—å€¼
        // å¯†é›†å€çš„é»è·é›¢é€šå¸¸ < 5pxï¼Œé›œè¨Šé€šå¸¸ > 10px
        let threshold = 10; 

        // 3. æ¨™è¨˜ç§»é™¤
        let cleanCount = 0;
        points.forEach(p => {
            if (p.dist > threshold) {
                p.keep = false;
            } else {
                p.keep = true;
                cleanCount++;
            }
        });

        document.getElementById('count-clean').innerText = cleanCount;
        drawPoints();
        
        // å‹•ç•«é¡¯ç¤ºéæ¿¾éç¨‹
        setTimeout(() => {
            // åªé‡ç¹ªç¶ é»
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            points.forEach(p => {
                if (p.keep) {
                    ctx.fillStyle = '#a3e635';
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            // åŠ ä¸Šæ–‡å­—
            ctx.fillStyle = 'white';
            ctx.font = '14px Consolas';
            ctx.fillText(`Filter Complete. Noise Removed.`, 10, 20);
        }, 1000);
    }

    // Init
    generateCloud();
</script>
<!-- NAV SCRIPT START -->
<script>
(function(){
    // è‡ªå‹•ç”Ÿæˆå°è¦½æŒ‰éˆ•
    const total=13; // ç¸½èª²æ•¸
    const page=location.pathname.split("/").pop();
    const num=parseInt(page.match(/lesson(\d+)\.html/i)?.[1]||0);
    if(!num)return;
    
    const prev=num>1?`lesson${String(num-1).padStart(2,'0')}.html`:'index.html';
    const next=num<total?`lesson${String(num+1).padStart(2,'0')}.html`:'#';
    const bg='#0f172a'; const color='white';

    const div=document.createElement('div');
    div.style.cssText="position:fixed;bottom:20px;right:20px;display:flex;gap:10px;z-index:9999;font-family:Consolas,monospace;";
    div.innerHTML=`
        <a href="${prev}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">â† PREV</a>
        <a href="index.html" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">MENU</a>
        <a href="${next}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;opacity:${num>=total?0.5:1};pointer-events:${num>=total?'none':'auto'}">NEXT â†’</a>
    `;
    document.body.appendChild(div);
})();
</script>
<!-- NAV SCRIPT END -->
</body>

</html>
