<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 07: å…¬è·¯çš„è…°èº«â€”â€”å–®æ›²ç·šèˆ‡ç·©å’Œæ›²ç·š</title>
    <style>
        :root {
            --bg-theory: #fff7ed; /* æš–æ©™è‰²èƒŒæ™¯ï¼Œè±¡å¾µé“è·¯è­¦ç¤º */
            --bg-field: #fffaf0;
            --bg-tool: #1a202c;
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-road: #f59e0b; /* é“è·¯é»ƒ */
            --accent-geo: #ea580c; /* å¹¾ä½•æ©™ */
            --border-color: #cbd5e1;
            --tech-cyan: #06b6d4;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-road);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-geo); color: #c2410c; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-road); color: #b45309; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 20px;
            border: 1px solid #334155;
        }
        .tool-panel h2 { border-color: var(--accent-road); color: var(--accent-road); }

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* æ•¸å­¸å¡ç‰‡ */
        .math-card {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--accent-geo);
            font-family: "Times New Roman", serif;
            font-style: italic;
            font-size: 24px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥ä»‹é¢ */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: #94a3b8; }
        input {
            width: 100%; padding: 12px; background: #1e293b; border: 1px solid #475569;
            color: white; border-radius: 6px; font-size: 18px; font-family: 'Consolas', monospace;
        }
        input:focus { outline: 2px solid var(--accent-road); border-color: transparent; }

        .btn {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white; border: none; padding: 15px;
            font-size: 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }

        /* è¡¨æ ¼çµæœ */
        .table-container {
            max-height: 400px; overflow-y: auto; margin-top: 20px;
            border: 1px solid #334155; border-radius: 8px;
        }
        table { width: 100%; border-collapse: collapse; font-family: 'Consolas', monospace; font-size: 16px; }
        th { background: #334155; color: #cbd5e1; padding: 10px; text-align: left; position: sticky; top: 0; }
        td { padding: 10px; border-bottom: 1px solid #334155; color: #e2e8f0; }
        tr:nth-child(even) { background: #1e293b; }
        tr:hover { background: #334155; }
        .highlight { color: var(--accent-road); font-weight: bold; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 07: å…¬è·¯çš„è…°èº« â€” å–®æ›²ç·šèˆ‡ç·©å’Œæ›²ç·š</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Road to Expert: ç›´ç·šèˆ‡åœ“ç„¡æ³•ç›´æ¥ç›¸é€£ã€‚å°±åƒé–‹è»Šä¸èƒ½ç¬é–“æŠŠæ–¹å‘ç›¤æ‰“åˆ°åº•ï¼Œæˆ‘å€‘éœ€è¦ã€Œç·©å’Œã€ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸš— ç›´è§€è­¬å–»ï¼šæ–¹å‘ç›¤çš„è»Œè·¡</h2>
        <p>å¦‚æœä½ åœ¨ç›´ç·šè¡Œé§› (åŠå¾‘ R = ç„¡é™å¤§)ï¼Œçªç„¶é€²å…¥ä¸€å€‹ R=200m çš„åœ“å½ï¼Œä½ çš„è»Šæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ
        <br><strong>é›¢å¿ƒåŠ›æœƒç¬é–“å¾ 0 è®Šæˆæœ€å¤§å€¼ã€‚</strong> ä¹˜å®¢æœƒåƒè¢«æ’æ“Šä¸€æ¨£ç”©å‡ºå»ã€‚</p>
        <p>çœŸå¯¦çš„é–‹è»Šéç¨‹æ˜¯ï¼š
        <br>1. ç›´ç·šï¼šæ–¹å‘ç›¤ä¸å‹•ã€‚
        <br>2. <strong>ç·©å’Œæ®µ (Spiral)ï¼š</strong> å‡å‹»åœ°è½‰å‹•æ–¹å‘ç›¤ (æ›²ç‡ $k$ å¾ 0 æ¼¸è®Šåˆ° $1/R$)ã€‚
        <br>3. åœ“æ›²ç·š (Circular)ï¼šå›ºå®šæ–¹å‘ç›¤è§’åº¦ (æ›²ç‡å›ºå®š)ã€‚</p>
        <p>é€™ç¨®ã€ŒåŠå¾‘ç”±ç„¡é™å¤§æ¼¸è®Šè‡³å®šå€¼ã€çš„æ›²ç·šï¼Œåœ¨æ•¸å­¸ä¸Šç¨±ç‚º<strong>å…‹ç¾…ç´¢æ›²ç·š (Clothoid)</strong>ï¼Œä¹Ÿå°±æ˜¯é«˜é€Ÿå…¬è·¯å·¥ç¨‹ä¸­çš„ã€Œç·©å’Œæ›²ç·šã€ã€‚</p>

        <h2>ğŸ“ è¦–è¦ºåœ–è§£ï¼šåœ“æ›²ç·šè¦ç´  (PC, PI, PT)</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                <line x1="50" y1="350" x2="400" y2="50" stroke="#94a3b8" stroke-width="2" stroke-dasharray="5"/>
                <line x1="750" y1="350" x2="400" y2="50" stroke="#94a3b8" stroke-width="2" stroke-dasharray="5"/>
                <text x="400" y="40" text-anchor="middle" font-weight="bold" fill="#64748b">äº¤é» IP (V)</text>

                <path d="M 150 264 A 300 300 0 0 1 650 264" fill="none" stroke="#f97316" stroke-width="4"/>

                <circle cx="150" cy="264" r="6" fill="#c2410c"/>
                <text x="130" y="260" font-weight="bold" fill="#c2410c">èµ·é» BC (PC)</text>

                <circle cx="650" cy="264" r="6" fill="#c2410c"/>
                <text x="670" y="260" font-weight="bold" fill="#c2410c">çµ‚é» EC (PT)</text>

                <circle cx="400" cy="300" r="4" fill="#333"/>
                <text x="400" y="320" text-anchor="middle" font-size="14">ä¸­é» MC</text>

                <line x1="400" y1="50" x2="400" y2="300" stroke="#333" stroke-width="1"/>
                <text x="410" y="150" font-size="14">å¤–è· E</text>

                <line x1="150" y1="264" x2="650" y2="264" stroke="#cbd5e1" stroke-dasharray="2"/>
                <text x="400" y="280" font-size="14" fill="#666">é•·å¼¦ C</text>

                <path d="M 400 100 Q 400 120 420 120" fill="none" stroke="#333"/>
                <text x="430" y="110" font-size="14">äº¤è§’ I (Î”)</text>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šè·¯æ©‹å·¥ç¨‹æœ€åŸºæœ¬çš„å–®æ›²ç·šã€‚åˆ‡ç·šäº¤æ–¼ IP é»ï¼Œæ›²ç·šå…§åˆ‡ã€‚å¤–è· E èˆ‡åˆ‡ç·šé•· T æ˜¯æ”¾æ¨£çš„æ§åˆ¶æ ¸å¿ƒã€‚</p>
        </div>

        <h2>ğŸ§® ç¡¬æ ¸ç†è«–ï¼šåè§’æ³• (Deflection Angle)</h2>
        <p>åœ¨æ²’æœ‰å…¨ç«™å„€åæ¨™æ”¾æ¨£çš„å¹´ä»£ï¼Œå·¥ç¨‹å¸«åªé ç¶“ç·¯å„€å’Œçš®å°ºå°±èƒ½ç•«å‡ºå®Œç¾çš„åœ“ã€‚é€™é çš„æ˜¯å¹¾ä½•å­¸çš„å¥‡è¹Ÿï¼š<strong>å¼¦åˆ‡è§’ç­‰æ–¼åœ“å‘¨è§’çš„ä¸€åŠã€‚</strong></p>
        
        <p>å‡è¨­ä½ æƒ³åœ¨æ›²ç·šä¸Šæ”¾æ¨£ä¸€é» $P$ï¼Œè·é›¢èµ·é» $BC$ çš„å¼§é•·ç‚º $l$ã€‚</p>
        <div class="math-card">
            åè§’ \delta = \frac{l}{2R} \times \frac{180}{\pi}
        </div>
        <p>å¯¦å‹™å¸¸ç”¨å…¬å¼ (åˆ†è¨ˆç®—)ï¼š<br>
        $\delta (min) = 1718.87 \times \frac{l}{R}$</p>
        <p><strong>æ“ä½œé‚è¼¯ï¼š</strong>
        <br>1. å„€å™¨æ¶åœ¨ BC é»ï¼Œå¾Œè¦– IP é» (æ­¸é›¶)ã€‚
        <br>2. æ—‹è½‰è§’åº¦ $\delta_1$ï¼Œæ‹‰è·é›¢ $C_1$ å®šå‡ºæ¨ä½ 1ã€‚
        <br>3. æ—‹è½‰è§’åº¦ $\delta_2$ï¼Œå¾æ¨ä½ 1 æ‹‰è·é›¢ $C_2$ (æˆ–å¾ BC æ‹‰ç¸½é•·) å®šå‡ºæ¨ä½ 2ã€‚</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šåæ¨™ä¸æ˜¯è¬èƒ½çš„</h2>
            
            <h3>1. ç‚ºä»€éº¼é‚„è¦å­¸åè§’æ³•ï¼Ÿ</h3>
            <p>ã€Œç¾åœ¨ä¸éƒ½ç”¨åæ¨™æ”¾æ¨£äº†å—ï¼Ÿã€
            <br>æ˜¯çš„ã€‚ä½†åœ¨éš§é“ã€æ¨¹æ—æˆ–å…¨ç«™å„€æ²’é›»æ™‚ï¼Œ<strong>åè§’æ³•+çš®å°º</strong>æ˜¯å”¯ä¸€çš„æ•‘å‘½ç´¢ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œç•¶ä½ æ‡·ç–‘åæ¨™æ”¾æ¨£æœ‰éŒ¯ (ä¾‹å¦‚æ›²ç·šçœ‹èµ·ä¾†ä¸é †)ï¼Œåè§’æ³•æ˜¯æœ€ç›´è§€çš„<strong>å¹¾ä½•æª¢æ ¸</strong>æ‰‹æ®µã€‚</p>

            <h3>2. çŸ­å¼¦é•· (Short Chord) çš„é¸æ“‡</h3>
            <p>æˆ‘å€‘ç„¡æ³•åœ¨ç¾å ´æ‹‰å‡ºã€Œå¼§ç·šã€ï¼Œåªèƒ½æ‹‰ã€Œç›´ç·š(å¼¦)ã€ã€‚
            <br>ç‚ºäº†è®“ç›´ç·šé€¼è¿‘åœ“å¼§ï¼Œæ¨è·å¿…é ˆå¤ çŸ­ã€‚
            <br>â— $R > 600m$ï¼šæ¯ 20m ä¸€æ¨ã€‚
            <br>â— $R < 300m$ï¼šæ¯ 10m ä¸€æ¨ã€‚
            <br>â— $R < 50m$ (åŒé“)ï¼šæ¯ 5m ä¸€æ¨ã€‚
            <br>å¦‚æœæ¨è·å¤ªå¤§ï¼Œåšå‡ºä¾†çš„è·¯æœƒåƒå¤šé‚Šå½¢ï¼Œè€Œä¸æ˜¯åœ“ã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸš§ äº’å‹•å·¥å…·ï¼šæ›²ç·šæ”¾æ¨£æ•¸æ“šç”Ÿæˆå™¨</h2>
            <p>è¼¸å…¥è¨­è¨ˆåƒæ•¸ï¼Œè‡ªå‹•ç”Ÿæˆã€Œåè§’æ³•ã€æ”¾æ¨£è¡¨ã€‚</p>
            
            <div class="input-grid">
                <div>
                    <label>æ›²ç·šåŠå¾‘ R (m)</label>
                    <input type="number" id="radius" value="200">
                </div>
                <div>
                    <label>äº¤è§’ I (Degree)</label>
                    <input type="number" id="deltaI" value="60">
                </div>
            </div>

            <div class="input-grid">
                <div>
                    <label>èµ·é»æ¨è™Ÿ BC (ex: 1230.5)</label>
                    <input type="number" id="stationBC" value="1000">
                </div>
                <div>
                    <label>æ”¾æ¨£é–“è· (m)</label>
                    <input type="number" id="interval" value="20">
                </div>
            </div>

            <button class="btn" onclick="calcCurve()">ğŸ“ ç”Ÿæˆæ”¾æ¨£æ•¸æ“šè¡¨</button>

            <div class="table-container" id="result-container" style="display:none;">
                <div style="padding:10px; background:#1e293b; border-bottom:1px solid #334155;">
                    <span style="color:#94a3b8;">æ›²ç·šé•· L: <span id="res-L" style="color:white;">--</span> m</span> | 
                    <span style="color:#94a3b8;">åˆ‡ç·šé•· T: <span id="res-T" style="color:white;">--</span> m</span>
                </div>
                <table id="result-table">
                    <thead>
                        <tr>
                            <th>æ¨è™Ÿ (Station)</th>
                            <th>å¼§é•· l</th>
                            <th>åè§’ (Deflection)</th>
                            <th>ç´¯ç©å¼¦é•· (Chord)</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script>
    function formatStation(val) {
        // æ ¼å¼åŒ–æ¨è™Ÿ 1000 -> 1k+000
        let k = Math.floor(val / 1000);
        let m = val % 1000;
        return `${k}k+${m.toFixed(2).padStart(6, '0')}`; // 0k+120.00
    }

    function formatDMS(degVal) {
        let d = Math.floor(degVal);
        let m = Math.floor((degVal - d) * 60);
        let s = Math.round(((degVal - d) * 60 - m) * 60);
        if(s === 60) { s=0; m++; }
        if(m === 60) { m=0; d++; }
        return `${d}Â°${m.toString().padStart(2,'0')}'${s.toString().padStart(2,'0')}"`;
    }

    function calcCurve() {
        const R = parseFloat(document.getElementById('radius').value);
        const I = parseFloat(document.getElementById('deltaI').value);
        const BC_sta = parseFloat(document.getElementById('stationBC').value);
        const interval = parseFloat(document.getElementById('interval').value);

        if([R, I, BC_sta, interval].some(isNaN)) {
            alert("è«‹è¼¸å…¥å®Œæ•´åƒæ•¸");
            return;
        }

        // 1. è¨ˆç®—å¹¾ä½•è¦ç´ 
        const I_rad = I * Math.PI / 180;
        const T = R * Math.tan(I_rad / 2);
        const L = R * I_rad; // æ›²ç·šé•·
        const EC_sta = BC_sta + L;

        document.getElementById('res-L').innerText = L.toFixed(3);
        document.getElementById('res-T').innerText = T.toFixed(3);

        // 2. ç”Ÿæˆæ¨è™Ÿåˆ—è¡¨
        // ç¬¬ä¸€å€‹æ•´æ¨è™Ÿ
        let currentSta = Math.ceil(BC_sta / interval) * interval;
        if (currentSta <= BC_sta) currentSta += interval;

        let points = [];
        
        // åŠ å…¥ BC
        points.push({ sta: BC_sta, type: 'BC' });

        // åŠ å…¥ä¸­é–“æ¨
        while (currentSta < EC_sta) {
            points.push({ sta: currentSta, type: 'Sta' });
            currentSta += interval;
        }

        // åŠ å…¥ EC
        points.push({ sta: EC_sta, type: 'EC' });

        // 3. è¨ˆç®—æ¯å€‹é»çš„åè§’èˆ‡å¼¦é•·
        let tbody = document.getElementById('result-table').querySelector('tbody');
        tbody.innerHTML = "";

        points.forEach(p => {
            let l = p.sta - BC_sta; // å¼§é•·
            if (l < 0) l = 0; // é˜²å‘†

            // åè§’å…¬å¼: delta = (l / 2R) * (180/PI)
            let delta_deg = (l / (2 * R)) * (180 / Math.PI);
            
            // å¼¦é•·å…¬å¼: C = 2R * sin(delta)
            let C = 2 * R * Math.sin(delta_deg * Math.PI / 180);

            let row = document.createElement('tr');
            let staClass = p.type === 'BC' || p.type === 'EC' ? 'highlight' : '';
            
            row.innerHTML = `
                <td class="${staClass}">${p.type === 'Sta' ? '' : p.type + ' '}${formatStation(p.sta)}</td>
                <td>${l.toFixed(2)}</td>
                <td style="color:#f59e0b;">${formatDMS(delta_deg)}</td>
                <td>${C.toFixed(3)}</td>
            `;
            tbody.appendChild(row);
        });

        document.getElementById('result-container').style.display = 'block';
    }
</script>
<!-- NAV SCRIPT START -->
<script>
(function(){
    // è‡ªå‹•ç”Ÿæˆå°è¦½æŒ‰éˆ•
    const total=13; // ç¸½èª²æ•¸
    const page=location.pathname.split("/").pop();
    const num=parseInt(page.match(/lesson(\d+)\.html/i)?.[1]||0);
    if(!num)return;
    
    const prev=num>1?`lesson${String(num-1).padStart(2,'0')}.html`:'index.html';
    const next=num<total?`lesson${String(num+1).padStart(2,'0')}.html`:'#';
    const bg='#0f172a'; const color='white';

    const div=document.createElement('div');
    div.style.cssText="position:fixed;bottom:20px;right:20px;display:flex;gap:10px;z-index:9999;font-family:Consolas,monospace;";
    div.innerHTML=`
        <a href="${prev}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">â† PREV</a>
        <a href="index.html" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">MENU</a>
        <a href="${next}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;opacity:${num>=total?0.5:1};pointer-events:${num>=total?'none':'auto'}">NEXT â†’</a>
    `;
    document.body.appendChild(div);
})();
</script>
<!-- NAV SCRIPT END -->
</body>

</html>
