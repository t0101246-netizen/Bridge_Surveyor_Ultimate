<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 02: æè¿°ä¸–ç•Œçš„èªè¨€â€”â€”åæ¨™ç³»çµ±èˆ‡å¹¾ä½•</title>
    <style>
        :root {
            --bg-theory: #f0f9ff;
            --bg-field: #fffaf0;
            --bg-tool: #1a202c;
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-blue: #0ea5e9;
            --accent-orange: #f97316;
            --border-color: #cbd5e1;
            --grid-line: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f1f5f9;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-orange); /* Lesson 2 ç”¨æ©™è‰²å€åˆ† */
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        h3 { font-size: 24px; margin-top: 1rem; color: #475569; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„æ¨£å¼ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-blue); color: #0369a1; }

        /* å³æ¬„æ¨£å¼ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-orange); color: #c2410c; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 20px;
        }
        .tool-panel h2 { border-color: var(--accent-blue); color: var(--accent-blue); }

        /* SVG æ¨£å¼ */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* æ•¸å­¸å¡ç‰‡ */
        .math-card {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--accent-blue);
            font-family: "Times New Roman", serif;
            font-style: italic;
            font-size: 24px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥èˆ‡æŒ‰éˆ• */
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 16px; margin-bottom: 5px; color: #cbd5e1; }
        input[type="number"] {
            width: 100%; padding: 12px; background: #334155; border: 1px solid #475569;
            color: white; border-radius: 6px; font-size: 18px; font-family: 'Consolas', monospace;
        }
        input:focus { outline: 2px solid var(--accent-blue); border-color: transparent; }

        .btn {
            background: var(--accent-blue); color: white; border: none; padding: 15px;
            font-size: 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold;
            transition: background 0.2s;
        }
        .btn:hover { background: #0284c7; }

        /* çµæœé¡¯ç¤ºå€ */
        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            background: #0f172a;
            padding: 20px;
            border-radius: 8px;
        }
        .result-cell {
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }
        .result-label { display: block; font-size: 14px; color: #94a3b8; }
        .result-val { font-size: 24px; color: var(--accent-orange); font-family: 'Consolas', monospace; font-weight: bold; }
        .unit { font-size: 16px; color: #64748b; margin-left: 5px; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 02: æè¿°ä¸–ç•Œçš„èªè¨€ â€” åæ¨™ç³»çµ±èˆ‡å¹¾ä½•</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Road to Expert: åœ°çƒæ˜¯åœ“çš„ï¼Œåœ–ç´™æ˜¯å¹³çš„ã€‚ç†è§£é€™å€‹çŸ›ç›¾ï¼Œä½ æ‰èƒ½çœ‹ç©¿ã€Œè·é›¢ã€çš„è¬Šè¨€ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸŠ ç›´è§€è­¬å–»ï¼šæ©˜å­çš®é›£é¡Œ</h2>
        <p>è«‹æƒ³åƒä½ åœ¨å‰æ©˜å­ã€‚å¦‚æœä½ æƒ³æŠŠä¸€æ•´å¡Šæ©˜å­çš®ã€Œå®Œç¾åœ°ã€å£“å¹³åœ¨æ¡Œä¸Šï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</p>
        <p>å®ƒä¸€å®šæœƒ<strong>è£‚é–‹</strong>ï¼Œæˆ–è€…ä½ å¿…é ˆå¼·è¡Œ<strong>æ‹‰ä¼¸</strong>å®ƒã€‚é€™å°±æ˜¯å¤§åœ°æ¸¬é‡çš„æ°¸æ†å›°å¢ƒï¼š<strong>ç„¡æ³•åœ¨ä¸é€ æˆè®Šå½¢çš„æƒ…æ³ä¸‹ï¼Œå°‡çƒé«”å±•é–‹æˆå¹³é¢ã€‚</strong></p>
        <p>å°ç£ä½¿ç”¨çš„ <strong>TWD97</strong> ç³»çµ±ï¼Œå°±åƒæ˜¯ç”¨ä¸€å€‹åœ“æŸ±é«”å¥—ä½åœ°çƒï¼ˆæ©˜å­ï¼‰ï¼Œç„¶å¾Œå°‡å½±åƒæŠ•å½±ä¸Šå»ã€‚ç‚ºäº†æ¸›å°‘è®Šå½¢ï¼Œæˆ‘å€‘è®“åœ“æŸ±é«”ã€Œåˆ‡å…¥ã€åœ°çƒå…§éƒ¨ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼æœƒæœ‰ã€Œå°ºåº¦ä¿‚æ•¸ã€(Scale Factor) çš„åŸå› ã€‚</p>

        <h2>ğŸŒ è¦–è¦ºåœ–è§£ï¼šæ©«éº¥å¡æ‰˜æŠ•å½± (TM2)</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0f0f0" stroke-width="1"/>
                    </pattern>
                </defs>
                <rect width="800" height="350" fill="url(#grid)" />

                <circle cx="200" cy="175" r="100" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="2" />
                <path d="M 200 75 A 30 100 0 0 1 200 275" fill="none" stroke="#0ea5e9" stroke-dasharray="4"/> <path d="M 100 175 Q 200 220 300 175" fill="none" stroke="#0ea5e9" opacity="0.5"/> <line x1="180" y1="50" x2="180" y2="300" stroke="#f97316" stroke-width="3"/>
                <line x1="220" y1="50" x2="220" y2="300" stroke="#f97316" stroke-width="3"/>
                <text x="200" y="320" font-size="14" text-anchor="middle" fill="#666">å‰²åœ“æŸ± (Secant)</text>

                <g transform="translate(450, 50)">
                    <rect x="0" y="0" width="300" height="250" fill="white" stroke="#cbd5e1" rx="10"/>
                    <text x="150" y="30" font-size="18" text-anchor="middle" font-weight="bold">å°ºåº¦ä¿‚æ•¸ (Scale Factor) k</text>
                    
                    <path d="M 50 150 Q 150 200 250 150" fill="none" stroke="#333" stroke-width="2"/>
                    <line x1="50" y1="150" x2="250" y2="150" stroke="#ef4444" stroke-width="2" stroke-dasharray="5"/>
                    <text x="260" y="155" font-size="14" fill="#ef4444">k=1 (æ¨™æº–ç·š)</text>

                    <line x1="150" y1="80" x2="150" y2="220" stroke="#0ea5e9" stroke-width="2"/>
                    <text x="150" y="240" font-size="14" text-anchor="middle" fill="#0ea5e9">ä¸­å¤®ç¶“ç·š 121Â°E</text>
                    <text x="150" y="190" font-size="16" text-anchor="middle" fill="#f97316" font-weight="bold">k = 0.9999</text>

                    <text x="50" y="140" font-size="14" text-anchor="middle">åˆ‡ç·š (k=1)</text>
                    <text x="250" y="140" font-size="14" text-anchor="middle">åˆ‡ç·š (k=1)</text>
                    <text x="150" y="70" font-size="12" fill="#666" text-anchor="middle">è·é›¢ä¸­å¤®ç¶“ç·šç´„ 90km è™• k=1</text>
                </g>
                
                <path d="M 220 175 L 450 175" stroke="#cbd5e1" stroke-dasharray="5" />
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šåœ¨ä¸­å¤®ç¶“ç·š (121Â°E)ï¼ŒæŠ•å½±é¢åˆ‡å…¥åœ°çƒå…§éƒ¨ï¼Œè·é›¢è¢«ã€Œç¸®çŸ­ã€äº†ï¼Œæ‰€ä»¥ k < 1ã€‚</p>
        </div>

        <h2>ğŸ“ ç¡¬æ ¸ç†è«–ï¼šç‚ºä»€éº¼æ˜¯ 0.9999ï¼Ÿ</h2>
        <p>åœ¨ TWD97 (TM2) ç³»çµ±ä¸­ï¼Œç‚ºäº†å¹³è¡¡æ•´å€‹æŠ•å½±å¸¶ï¼ˆè·¨åº¦ 2 åº¦ï¼‰çš„è®Šå½¢ï¼Œæˆ‘å€‘äººç‚ºè¦å®šä¸­å¤®ç¶“ç·šçš„å°ºåº¦ä¿‚æ•¸ $k_0 = 0.9999$ã€‚</p>
        
        <div class="math-card">
            S_{grid} = S_{ground} \times k
        </div>
        
        <p>é€™æ„å‘³è‘—ï¼šåœ¨ä¸­å¤®ç¶“ç·šï¼ˆç´„å—æŠ•ã€é«˜é›„å¸‚å€ï¼‰ï¼Œå¦‚æœæ‚¨åœ¨åœ°é¢ä¸Šé‡æ¸¬äº† 1000 å…¬å°ºï¼Œåœ¨åœ–ç´™ä¸Šï¼ˆåæ¨™åç®—ï¼‰åªæœƒå¾—åˆ° 999.9 å…¬å°ºã€‚</p>
        <p><strong>é€™ 10 å…¬åˆ†çš„å·®ç•°å»å“ªäº†ï¼Ÿ</strong><br>
        å®ƒæ¶ˆå¤±åœ¨æŠ•å½±çš„æ•¸å­¸å£“ç¸®ä¸­ã€‚å¦‚æœæ‚¨åœ¨åšé«˜éµæˆ–é•·è·¨è·æ©‹æ¨‘ï¼Œé€™ 1/10,000 çš„èª¤å·®å¦‚æœä¸ä¿®æ­£ï¼Œæœ€å¾Œæ©‹æ¨‘åˆé¾æ™‚å°±æœƒç™¼ç”Ÿã€Œç¡¬æŠŠæ©˜å­çš®æ‹‰ç ´ã€çš„æ…˜åŠ‡ã€‚</p>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šåæ¨™çš„é™·é˜±</h2>
            
            <h3>1. çœŸåŒ— (TN) vs. æ ¼åŒ— (GN)</h3>
            <p>åœ–ç´™ä¸Šçš„ä¸Šé¢æ˜¯ã€ŒåŒ—ã€ï¼Œä½†é‚£æ˜¯<strong>æ ¼åŒ— (Grid North)</strong>ï¼Œä¹Ÿå°±æ˜¯ Y è»¸çš„æ–¹å‘ã€‚è€Œä½ çš„ç¾…ç›¤æŒ‡çš„ä¹Ÿä¸æ˜¯<strong>çœŸåŒ— (True North)</strong>ï¼Œæ˜¯ç£åŒ—ã€‚<br>
            åœ¨æ¸¬é‡æ”¾æ¨£æ™‚ï¼Œæˆ‘å€‘åªèªã€Œåæ¨™æ–¹ä½è§’ã€ï¼Œä¹Ÿå°±æ˜¯ç›¸å°æ–¼æ ¼åŒ—çš„è§’åº¦ã€‚åˆ‡è¨˜ï¼š<strong>å…¨ç«™å„€è¨­ç«™æ™‚ï¼Œå¿…é ˆä¾æ“šå·²çŸ¥é»åæ¨™å®šå‘</strong>ï¼Œåƒè¬åˆ¥æ‹¿æŒ‡åŒ—é‡ä¾†å®šæ–¹ä½ï¼</p>

            <h3>2. TWD67 èˆ‡ TWD97 çš„å¹½éˆ</h3>
            <p>å°ç£æœ‰å…©å€‹åæ¨™ç³»çµ±ä¸¦å­˜ã€‚
            <br>TWD97 æ˜¯æ–°ç³»çµ±ï¼ˆåŸºæ–¼ GRS80 æ©¢çƒï¼‰ã€‚
            <br>TWD67 æ˜¯èˆŠç³»çµ±ï¼ˆåŸºæ–¼ Hu-Tzu-Shan 1967ï¼‰ã€‚
            <br><strong>å…©è€…ç›¸å·®ç´„ 800 å…¬å°ºï¼</strong> å¦‚æœä½ ç™¼ç¾æ”¾æ¨£é»ä½è·‘åˆ°é¦¬è·¯å°é¢æˆ–æµ·è£¡ï¼Œç¬¬ä¸€ä»¶äº‹å…ˆæª¢æŸ¥ï¼šæ˜¯ä¸æ˜¯æ‹¿åˆ°èˆŠåœ–äº†ï¼Ÿ</p>
            <blockquote>
                <strong>åˆ¤æ–·å£è¨£ï¼š</strong>
                é›–ç„¶æ•¸å€¼å¾ˆåƒï¼Œä½†é€šå¸¸ TWD97 çš„åæ¨™å€¼æœƒæ¯” TWD67 å¤§ä¸€äº›ï¼ˆè¦–åœ°å€è€Œå®šï¼Œç„¡çµ•å°å…¬å¼ï¼Œå¿…é ˆé€éè½‰æ›ç¨‹å¼ï¼‰ã€‚æœ€ä¿éšªçš„æ–¹å¼ï¼š<strong>æ‰¾ä¸€å€‹å·²çŸ¥æ§åˆ¶é»æ ¸å°åæ¨™</strong>ã€‚
            </blockquote>
        </div>

        <div class="tool-panel">
            <h2>ğŸ§­ äº’å‹•å·¥å…·ï¼šTWD97 åæ¨™åç®—å¤§å¸«</h2>
            <p>è¼¸å…¥å…©é»åæ¨™ (N, E)ï¼Œè¨ˆç®—ç²¾ç¢ºçš„æ–¹ä½è§’èˆ‡å¹³é¢è·é›¢ã€‚</p>
            
            <h3 style="color:var(--accent-blue); font-size:18px; margin-bottom:10px;">æ¸¬ç«™é» A (Start Point)</h3>
            <div class="input-row">
                <div>
                    <label>N (åŒ—/ç¸±åæ¨™)</label>
                    <input type="number" id="n1" placeholder="27xxxxxx" value="2685210.550">
                </div>
                <div>
                    <label>E (æ±/æ©«åæ¨™)</label>
                    <input type="number" id="e1" placeholder="2xxxxxx" value="215430.220">
                </div>
            </div>

            <h3 style="color:var(--accent-orange); font-size:18px; margin-bottom:10px;">å¾Œè¦–/æ”¾æ¨£é» B (Target Point)</h3>
            <div class="input-row">
                <div>
                    <label>N (åŒ—/ç¸±åæ¨™)</label>
                    <input type="number" id="n2" placeholder="27xxxxxx" value="2685350.120">
                </div>
                <div>
                    <label>E (æ±/æ©«åæ¨™)</label>
                    <input type="number" id="e2" placeholder="2xxxxxx" value="215580.450">
                </div>
            </div>

            <button class="btn" onclick="calculateInverse()">ğŸš€ è¨ˆç®—æ–¹ä½è§’èˆ‡è·é›¢</button>

            <div class="result-grid">
                <div class="result-cell">
                    <span class="result-label">å¹³é¢è·é›¢ (Grid Distance)</span>
                    <span class="result-val" id="res-dist">--</span><span class="unit">m</span>
                </div>
                <div class="result-cell">
                    <span class="result-label">æ–¹ä½è§’ (Azimuth)</span>
                    <span class="result-val" id="res-azi">--</span><span class="unit">dms</span>
                </div>
                <div class="result-cell" style="grid-column: 1 / -1; border-bottom: none;">
                    <span class="result-label">å°ºåº¦ä¿‚æ•¸ä¼°ç®— (Scale Factor Estimate)</span>
                    <span class="result-val" id="res-scale" style="font-size:20px; color:#38bdf8;">--</span>
                    <p style="font-size:12px; color:#64748b; margin-top:5px;">*åƒ…ä¾æ“šæ©«åæ¨™ä¼°ç®—ï¼ŒæœªåŒ…å«é«˜ç¨‹æ”¹æ­£</p>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // æ ¼å¼åŒ– DMS (åº¦åˆ†ç§’)
    function formatDMS(degrees) {
        let d = Math.floor(degrees);
        let m = Math.floor((degrees - d) * 60);
        let s = ((degrees - d - m/60) * 3600).toFixed(1);
        
        // é€²ä½è™•ç†
        if (s >= 60) { s = 0; m++; }
        if (m >= 60) { m = 0; d++; }

        // è£œé›¶
        let mStr = m.toString().padStart(2, '0');
        let sStr = s.toString().padStart(4, '0'); // 00.0
        
        return `${d}Â° ${mStr}' ${sStr}"`;
    }

    function calculateInverse() {
        // ç²å–è¼¸å…¥
        const n1 = parseFloat(document.getElementById('n1').value);
        const e1 = parseFloat(document.getElementById('e1').value);
        const n2 = parseFloat(document.getElementById('n2').value);
        const e2 = parseFloat(document.getElementById('e2').value);

        if (isNaN(n1) || isNaN(e1) || isNaN(n2) || isNaN(e2)) {
            alert("è«‹è¼¸å…¥å®Œæ•´çš„åæ¨™æ•¸å€¼ï¼");
            return;
        }

        // è¨ˆç®—å·®å€¼
        const dN = n2 - n1;
        const dE = e2 - e1;

        // 1. è¨ˆç®—è·é›¢
        const dist = Math.sqrt(dN*dN + dE*dE);

        // 2. è¨ˆç®—æ–¹ä½è§’ (æ•¸å­¸ atan2 è¿”å›çš„æ˜¯èˆ‡ X è»¸å¤¾è§’ï¼Œéœ€è½‰æ›ç‚ºæ¸¬é‡æ–¹ä½è§’)
        // æ¸¬é‡æ–¹ä½è§’ï¼šåŒ—ç‚º 0ï¼Œé †æ™‚é‡å¢åŠ ã€‚
        // Math.atan2(y, x) -> Math.atan2(dN, dE) ? ä¸ï¼Œé€™æ˜¯æ•¸å­¸åæ¨™
        // æ¸¬é‡åæ¨™ï¼šN æ˜¯ y è»¸, E æ˜¯ x è»¸ã€‚
        // æ–¹ä½è§’ = atan2(dE, dN)
        let rad = Math.atan2(dE, dN);
        let deg = rad * (180 / Math.PI);

        if (deg < 0) {
            deg += 360;
        }

        // 3. ç°¡æ˜“ä¼°ç®—å°ºåº¦ä¿‚æ•¸ (åƒ…åƒè€ƒ)
        // ä¸­å¤®ç¶“ç·š E = 250,000
        // å…¬å¼ï¼šk = 0.9999 * (1 + (E' ^ 2) / (2 * R^2))
        // ç°¡åŒ–ï¼šk â‰ˆ 0.9999 + 1.23E-14 * (E - 250000)^2
        const avgE = (e1 + e2) / 2;
        const deltaE = Math.abs(avgE - 250000);
        // R ç´„ç‚º 6371000m
        const k = 0.9999 * (1 + (deltaE * deltaE) / (2 * 6371000 * 6371000));
        
        // æ›´æ–°é¡¯ç¤º
        document.getElementById('res-dist').innerText = dist.toFixed(3);
        document.getElementById('res-azi').innerText = formatDMS(deg);
        document.getElementById('res-scale').innerText = k.toFixed(6);
    }
</script>

</body>
</html>