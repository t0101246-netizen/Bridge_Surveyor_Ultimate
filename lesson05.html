<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 05: å…‰èˆ‡è§’çš„äº¤æœƒâ€”â€”å…¨ç«™å„€æ¸¬è·æ¸¬è§’åŸç†</title>
    <style>
        :root {
            --bg-theory: #eef2ff; /* ç§‘æŠ€è—ç´« */
            --bg-field: #fffaf0;
            --bg-tool: #0f172a; /* æ·±é‚ƒå¤œç©ºè‰² */
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-laser: #3b82f6; /* é›·å°„è— */
            --accent-warn: #ef4444;
            --border-color: #cbd5e1;
            --neon-green: #22c55e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-laser);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-laser); color: #1d4ed8; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-warn); color: #c2410c; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 20px;
            border: 1px solid #334155;
        }
        .tool-panel h2 { border-color: var(--neon-green); color: var(--neon-green); text-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* æ•¸å­¸å¡ç‰‡ */
        .math-card {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--accent-laser);
            font-family: "Times New Roman", serif;
            font-style: italic;
            font-size: 24px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥ä»‹é¢ */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: #94a3b8; }
        input, select {
            width: 100%; padding: 12px; background: #1e293b; border: 1px solid #475569;
            color: white; border-radius: 6px; font-size: 18px; font-family: 'Consolas', monospace;
        }
        input:focus { outline: 2px solid var(--accent-laser); border-color: transparent; }

        .btn {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white; border: none; padding: 15px;
            font-size: 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }

        .result-screen {
            background: #000;
            border: 2px solid #334155;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Consolas', monospace;
            color: var(--neon-green);
        }
        .res-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #333; padding-bottom: 5px; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 05: å…‰èˆ‡è§’çš„äº¤æœƒ â€” å…¨ç«™å„€æ¸¬è·æ¸¬è§’åŸç†</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Road to Expert: å®ƒç™¼å°„çš„æ˜¯ä¸å¯è¦‹å…‰ï¼Œä½†ä½ å¿…é ˆçœ‹è¦‹éš±è—çš„èª¤å·®ï¼šæº«åº¦ã€æ°£å£“èˆ‡åœ°çƒçš„å¼§åº¦ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>ğŸ”¦ ç›´è§€è­¬å–»ï¼šå›éŸ³èˆ‡å°º</h2>
        <p>å…¨ç«™å„€ (Total Station) æ¸¬è·çš„åŸç†ï¼Œä¸åƒä½ æ‹¿çš®å°ºå»é‡ï¼Œè€Œæ¯”è¼ƒåƒ<strong>ã€Œå–Šè©±è½å›éŸ³ã€</strong>ã€‚</p>
        <p>å„€å™¨ç™¼å°„ä¸€é“ç´…å¤–ç·šå…‰æ³¢æ‰“åˆ°ç¨œé¡ï¼Œå†åå°„å›ä¾†ã€‚å„€å™¨ä¸¦ä¸æ˜¯è¨ˆç®—å…‰è·‘äº†å¤šä¹…ï¼ˆå…‰é€Ÿå¤ªå¿«ç®—ä¸æº–ï¼‰ï¼Œè€Œæ˜¯è¨ˆç®—<strong>ã€Œå…‰æ³¢çš„ç›¸ä½å·®ã€</strong>ã€‚
        <br>æƒ³åƒä½ æ‹¿è‘—ä¸€æ ¹å½ˆç°§ç¹©ï¼ˆå…‰æ³¢ï¼‰çš„ä¸€ç«¯ï¼Œæœ‹å‹æ‹¿è‘—å¦ä¸€ç«¯ï¼ˆç¨œé¡ï¼‰ã€‚ä½ æŠ–å‹•ç¹©å­å‚³éæ³¢æµªï¼Œé€šéè¨ˆç®—æ³¢å³°å›ä¾†çš„ç‹€æ…‹ï¼Œå°±èƒ½ç²¾ç¢ºè§£ç®—å‡ºè·é›¢ã€‚</p>

        <h2>ğŸ“ è¦–è¦ºåœ–è§£ï¼šä¸‰è§’é«˜ç¨‹ (Trigonometric Leveling)</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg">
                <path d="M 50 300 Q 400 280 750 300" fill="none" stroke="#64748b" stroke-width="2"/>
                <text x="400" y="320" text-anchor="middle" fill="#64748b">åœ°çƒæ›²ç‡ R</text>

                <g transform="translate(150, 292)">
                    <rect x="-5" y="-40" width="10" height="40" fill="#333"/>
                    <circle cx="0" cy="-45" r="5" fill="#3b82f6"/> <text x="-20" y="-20" text-anchor="end" font-weight="bold">Instr (A)</text>
                    <line x1="0" y1="-45" x2="0" y2="0" stroke="#333" stroke-dasharray="2"/>
                    <text x="-15" y="-30" font-size="14" fill="#666">i (å„€é«˜)</text>
                </g>

                <g transform="translate(650, 150)"> <rect x="-2" y="0" width="4" height="142" fill="#333"/>
                    <circle cx="0" cy="0" r="15" fill="none" stroke="#ef4444" stroke-width="2"/>
                    <text x="20" y="70" text-anchor="start" font-weight="bold">Target (B)</text>
                    <text x="10" y="50" font-size="14" fill="#666">z (ç¨œé¡é«˜)</text>
                </g>

                <line x1="150" y1="247" x2="650" y2="150" stroke="#3b82f6" stroke-width="2"/>
                <text x="400" y="190" text-anchor="middle" fill="#3b82f6" font-weight="bold" font-size="16">æ–œè· S</text>

                <line x1="150" y1="247" x2="150" y2="100" stroke="#94a3b8" stroke-dasharray="4"/> <path d="M 150 130 A 60 60 0 0 1 200 140" fill="none" stroke="#333"/>
                <text x="170" y="130" font-size="14">Z (å¤©é ‚è·)</text>

                <line x1="150" y1="247" x2="650" y2="247" stroke="#cbd5e1" stroke-dasharray="2"/> <line x1="650" y1="247" x2="650" y2="292" stroke="#ef4444" stroke-width="2"/> <text x="660" y="270" fill="#ef4444" font-size="14">C&R æ”¹æ­£</text>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šé€éæ¸¬é‡æ–œè·(S)èˆ‡å¤©é ‚è§’(Z)ï¼Œæ¨ç®—é«˜ç¨‹å·®ã€‚æ³¨æ„ç´…è‰²éƒ¨åˆ†çš„ã€Œçƒæ°£å·®ã€ï¼šåœ°çƒæ˜¯åœ“çš„(C)ï¼Œå…‰ç·šæœƒæŠ˜å°„(R)ã€‚</p>
        </div>

        <h2>ğŸ“ ç¡¬æ ¸ç†è«–ï¼šçƒæ°£å·® (C&R)</h2>
        <p>ç°¡å–®çš„ä¸‰è§’å‡½æ•¸ $\Delta H = S \cdot \cos(Z)$ åªæœ‰åœ¨çŸ­è·é›¢ï¼ˆ&lt;100mï¼‰æœ‰æ•ˆã€‚ä¸€æ—¦è·é›¢æ‹‰é•·ï¼Œåœ°çƒçš„åœ“å¼§æœƒè®“ç›®æ¨™é»ã€Œå¾€ä¸‹æ²‰ã€ï¼Œè€Œå¤§æ°£æŠ˜å…‰æœƒè®“è¦–ç·šã€Œå¾€ä¸Šç¿¹ã€ã€‚</p>
        
        <div class="math-card">
            \Delta H = S \cos Z + \frac{(1-k)D^2}{2R} + i - z
        </div>
        
        <ul>
            <li><strong>S</strong>: æ–œè· (Slope Distance)</li>
            <li><strong>Z</strong>: å¤©é ‚è· (Zenith Angle, 0Â°åœ¨é ­é ‚)</li>
            <li><strong>k</strong>: æŠ˜å…‰ä¿‚æ•¸ (Refraction), å°ç£é€šå¸¸å– 0.13 - 0.14</li>
            <li><strong>R</strong>: åœ°çƒåŠå¾‘, ç´„ 6371 km</li>
            <li><strong>(1-k)DÂ²/2R</strong>: é€™å°±æ˜¯è‘—åçš„ã€Œçƒæ°£å·®æ”¹æ­£ã€ã€‚åœ¨ 1km çš„è·é›¢ä¸‹ï¼Œé€™å€‹ä¿®æ­£é‡é«˜é” <strong>6.7å…¬åˆ†</strong>ï¼ä¸åšä¿®æ­£ï¼Œæ©‹æ¨‘ä¸€å®šæ¥ä¸èµ·ä¾†ã€‚</li>
        </ul>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šéš±å½¢çš„æ®ºæ‰‹</h2>
            
            <h3>1. ç¨œé¡å¸¸æ•¸ (Prism Constant) çš„é™·é˜±</h3>
            <p>é€™æ˜¯æ–°æ‰‹æœ€å¸¸çŠ¯çš„è‡´å‘½éŒ¯èª¤ã€‚
            <br>â— <strong>æ¨™æº–å–®ç¨œé¡</strong>ï¼šå…‰ç·šåœ¨ç»ç’ƒå…§æŠ˜å°„è·¯å¾‘è¼ƒé•·ï¼Œç‰©ç†ä¸­å¿ƒèˆ‡å…‰å­¸ä¸­å¿ƒä¸é‡åˆï¼Œå¸¸æ•¸é€šå¸¸æ˜¯ <strong>-30mm</strong>ã€‚
            <br>â— <strong>è¿·ä½ ç¨œé¡/è²¼ç´™</strong>ï¼šé€šå¸¸æ˜¯ <strong>0mm</strong> æˆ– <strong>-17.5mm</strong>ã€‚
            <br><strong>æ…˜æ¡ˆç¾å ´ï¼š</strong> å¦‚æœå„€å™¨è¨­å®š -30ï¼Œä½ å»ç”¨ 0 çš„ç¨œé¡æ¸¬ï¼Œæ¯ä¸€é»éƒ½æœƒ<strong>çŸ­å°‘ 3å…¬åˆ†</strong>ã€‚å…¨ç·š 100 é»å°±å·®äº† 3 ç±³ï¼Ÿä¸ï¼Œæ˜¯æ¯ä¸€æ®µéƒ½éŒ¯ï¼Œç´¯ç©èª¤å·®é›£ä»¥è¿½æŸ¥ã€‚<strong>å‹™å¿…åœ¨é–‹å·¥å‰ï¼Œæ‹¿é‹¼æ²å°ºå¯¦æ¸¬ä¸€æ¬¡å„€å™¨è®€æ•¸ï¼</strong></p>

            <h3>2. PPM (æ°£è±¡æ”¹æ­£)</h3>
            <p>å…‰é€Ÿæœƒå—æº«åº¦å’Œæ°£å£“å½±éŸ¿ã€‚
            <br>å†¬å¤©å¯’æµ (10Â°C) å’Œå¤å¤©æŸæ²¹è·¯ (45Â°C)ï¼Œç©ºæ°£å¯†åº¦ä¸åŒã€‚å¦‚æœä¸è¨­å®š PPMï¼Œ1å…¬é‡Œå¯èƒ½æœƒç”¢ç”Ÿ 20mm çš„èª¤å·®ã€‚ç¾åœ¨çš„å„€å™¨éƒ½æœ‰è‡ªå‹•æ„Ÿæ¸¬å™¨ï¼Œä½†è«‹å‹™å¿…ç¢ºèªæ„Ÿæ¸¬å™¨æ˜¯å¦é–‹å•Ÿï¼Œæˆ–è€…æ‰‹å‹•è¼¸å…¥ç¾å ´æº«åº¦ã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸ”­ äº’å‹•å·¥å…·ï¼šä¸‰è§’é«˜ç¨‹ç²¾å¯†è¨ˆç®—å™¨</h2>
            <p>è¼¸å…¥å…¨ç«™å„€è§€æ¸¬æ•¸æ“šï¼Œè‡ªå‹•é€²è¡Œã€Œçƒæ°£å·®æ”¹æ­£ã€ä¸¦è¨ˆç®—ç²¾ç¢ºé«˜ç¨‹ã€‚</p>
            
            <div class="input-grid">
                <div>
                    <label>æ–œè· S (Slope Dist)</label>
                    <input type="number" id="slopeDist" placeholder="150.550" step="0.001">
                </div>
                <div>
                    <label>å¤©é ‚è§’ Z (Zenith)</label>
                    <input type="number" id="zenithAngle" placeholder="85.3020 (D.MMSS)" step="0.0001">
                </div>
            </div>

            <div class="input-grid">
                <div>
                    <label>å„€å™¨é«˜ i (Instr. H)</label>
                    <input type="number" id="hi" value="1.500" step="0.001">
                </div>
                <div>
                    <label>ç¨œé¡é«˜ z (Target H)</label>
                    <input type="number" id="ht" value="1.500" step="0.001">
                </div>
            </div>
            
            <div class="input-grid">
                <div>
                    <label>æ¸¬ç«™é«˜ç¨‹ H_A</label>
                    <input type="number" id="ha" value="100.000" step="0.001">
                </div>
                <div style="display:flex; align-items:end;">
                     <div style="font-size:12px; color:#64748b;">*é è¨­ k=0.13</div>
                </div>
            </div>

            <button class="btn" onclick="calcTrigLeveling()">âš¡ ç™¼å°„é›·å°„ä¸¦è¨ˆç®—</button>

            <div class="result-screen" id="result-screen" style="display:none;">
                <div class="res-row">
                    <span>æ°´å¹³è·é›¢ (HD):</span>
                    <span id="res-hd">-- m</span>
                </div>
                <div class="res-row">
                    <span>å‚ç›´åˆ†é‡ (V):</span>
                    <span id="res-v">-- m</span>
                </div>
                <div class="res-row">
                    <span>çƒæ°£å·®æ”¹æ­£ (C&R):</span>
                    <span id="res-cr" style="color:#ef4444;">-- m</span>
                </div>
                <div class="res-row" style="border-bottom: 2px solid var(--neon-green); margin-top:10px;">
                    <span style="font-size:18px;">é«˜ç¨‹å·® (Î”H):</span>
                    <span id="res-dh" style="font-size:20px; font-weight:bold;">-- m</span>
                </div>
                <div style="text-align:center; margin-top:15px;">
                    <span style="display:block; color:#94a3b8; font-size:14px;">ç›®æ¨™é»é«˜ç¨‹ (H_B)</span>
                    <span id="res-hb" style="font-size:32px; font-weight:bold; color:white;">--</span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // å°‡ D.MMSS æ ¼å¼è½‰æ›ç‚º å¼§åº¦
    function dmsToRad(dms) {
        let deg = Math.floor(dms);
        let minsec = (dms - deg) * 100;
        let min = Math.floor(minsec);
        let sec = (minsec - min) * 100;
        
        let decimalDeg = deg + min/60 + sec/3600;
        return decimalDeg * (Math.PI / 180);
    }

    function calcTrigLeveling() {
        const S = parseFloat(document.getElementById('slopeDist').value);
        const Z_dms = parseFloat(document.getElementById('zenithAngle').value);
        const i = parseFloat(document.getElementById('hi').value);
        const z = parseFloat(document.getElementById('ht').value);
        const Ha = parseFloat(document.getElementById('ha').value);

        if (isNaN(S) || isNaN(Z_dms) || isNaN(i) || isNaN(z)) {
            alert("è«‹è¼¸å…¥å®Œæ•´è§€æ¸¬æ•¸æ“šï¼");
            return;
        }

        // è½‰æ›è§’åº¦
        const Z_rad = dmsToRad(Z_dms);

        // 1. åŸºæœ¬ä¸‰è§’è¨ˆç®—
        // æ°´å¹³è·é›¢ HD = S * sin(Z)
        const HD = S * Math.sin(Z_rad);
        // å‚ç›´åˆ†é‡ V = S * cos(Z) (æ³¨æ„ï¼šå¤©é ‚è·å…¬å¼)
        const V = S * Math.cos(Z_rad);

        // 2. çƒæ°£å·®æ”¹æ­£ (Earth Curvature & Refraction)
        // å…¬å¼ï¼šC&R = (1 - k) * HD^2 / (2 * R)
        // R = 6371000 m, k = 0.13
        const R = 6371000;
        const k = 0.13;
        const CR = (1 - k) * (HD * HD) / (2 * R);

        // 3. é«˜ç¨‹å·®è¨ˆç®—
        // Î”H = V + CR + i - z
        const dH = V + CR + i - z;

        // 4. æœ€çµ‚é«˜ç¨‹
        const Hb = Ha + dH;

        // é¡¯ç¤ºçµæœ
        document.getElementById('res-hd').innerText = HD.toFixed(3) + " m";
        document.getElementById('res-v').innerText = V.toFixed(3) + " m";
        document.getElementById('res-cr').innerText = "+" + CR.toFixed(4) + " m";
        document.getElementById('res-dh').innerText = (dH > 0 ? "+" : "") + dH.toFixed(3) + " m";
        document.getElementById('res-hb').innerText = Hb.toFixed(3);

        document.getElementById('result-screen').style.display = 'block';
    }
</script>
<!-- NAV SCRIPT START -->
<script>
(function(){
    // è‡ªå‹•ç”Ÿæˆå°è¦½æŒ‰éˆ•
    const total=13; // ç¸½èª²æ•¸
    const page=location.pathname.split("/").pop();
    const num=parseInt(page.match(/lesson(\d+)\.html/i)?.[1]||0);
    if(!num)return;
    
    const prev=num>1?`lesson${String(num-1).padStart(2,'0')}.html`:'index.html';
    const next=num<total?`lesson${String(num+1).padStart(2,'0')}.html`:'#';
    const bg='#0f172a'; const color='white';

    const div=document.createElement('div');
    div.style.cssText="position:fixed;bottom:20px;right:20px;display:flex;gap:10px;z-index:9999;font-family:Consolas,monospace;";
    div.innerHTML=`
        <a href="${prev}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">â† PREV</a>
        <a href="index.html" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;">MENU</a>
        <a href="${next}" style="background:${bg};color:${color};padding:10px 20px;text-decoration:none;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.3);font-weight:bold;opacity:${num>=total?0.5:1};pointer-events:${num>=total?'none':'auto'}">NEXT â†’</a>
    `;
    document.body.appendChild(div);
})();
</script>
<!-- NAV SCRIPT END -->
</body>

</html>
