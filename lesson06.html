<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 06: å®šä½è‡ªå·±çš„ä½ç½®â€”â€”å°ç·šæ¸¬é‡èˆ‡å¾Œæ–¹äº¤æœƒ</title>
    <style>
        :root {
            --bg-theory: #fff1f2; /* ç«ç‘°ç´…èƒŒæ™¯ï¼Œè±¡å¾µå¹¾ä½•çš„ç†±æƒ… */
            --bg-field: #fffaf0;
            --bg-tool: #0f172a;
            --text-main: #334155;
            --text-light: #f8fafc;
            --accent-pink: #e11d48; /* å¹¾ä½•ä¸»é¡Œè‰² */
            --accent-orange: #f97316;
            --border-color: #cbd5e1;
            --tech-cyan: #06b6d4;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: #f8fafc;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 98%;
            max-width: 1920px;
            margin: 0 auto;
            padding: 20px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        header {
            grid-column: 1 / -1;
            background: white;
            padding: 2rem;
            border-bottom: 4px solid var(--accent-pink);
            margin-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 { font-size: 36px; font-weight: 800; color: #1e293b; letter-spacing: -0.025em; }
        h2 { font-size: 28px; margin-top: 1.5rem; margin-bottom: 1rem; border-left: 5px solid; padding-left: 15px; }
        p, li { font-size: 22px; margin-bottom: 1rem; text-align: justify; }

        /* å·¦æ¬„ */
        .theory-column {
            background-color: var(--bg-theory);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .theory-column h2 { border-color: var(--accent-pink); color: #be123c; }

        /* å³æ¬„ */
        .field-column { display: flex; flex-direction: column; gap: 20px; }
        .field-panel {
            background-color: var(--bg-field);
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .field-panel h2 { border-color: var(--accent-orange); color: #c2410c; }

        /* å·¥å…·é¢æ¿ */
        .tool-panel {
            background-color: var(--bg-tool);
            color: var(--text-light);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);
            position: sticky;
            top: 20px;
            border: 1px solid #334155;
        }
        .tool-panel h2 { border-color: var(--tech-cyan); color: var(--tech-cyan); }

        /* SVG */
        .svg-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        /* æ•¸å­¸å¡ç‰‡ */
        .math-card {
            background: white;
            padding: 20px;
            border-left: 4px solid var(--accent-pink);
            font-family: "Times New Roman", serif;
            font-style: italic;
            font-size: 24px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* è¼¸å…¥ä»‹é¢ */
        .input-group { margin-bottom: 15px; padding: 15px; background: #1e293b; border-radius: 8px; }
        .input-group h3 { color: var(--tech-cyan); margin-bottom: 10px; font-size: 18px; border-bottom: 1px solid #334155; padding-bottom: 5px; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        label { display: block; font-size: 14px; margin-bottom: 5px; color: #94a3b8; }
        input {
            width: 100%; padding: 10px; background: #0f172a; border: 1px solid #475569;
            color: white; border-radius: 4px; font-size: 16px; font-family: 'Consolas', monospace;
        }
        input:focus { outline: 2px solid var(--tech-cyan); border-color: transparent; }

        .btn {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            color: white; border: none; padding: 15px; margin-top: 10px;
            font-size: 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold;
        }
        .btn:hover { filter: brightness(1.1); }

        .result-screen {
            background: #000; border: 2px solid #334155; padding: 20px;
            border-radius: 8px; margin-top: 20px; font-family: 'Consolas', monospace;
            color: var(--tech-cyan);
        }
        .res-coord { font-size: 24px; font-weight: bold; color: white; display: block; margin: 10px 0; }
        .res-label { color: #64748b; font-size: 14px; }

        @media (max-width: 1200px) {
            .container { grid-template-columns: 1fr; }
            .tool-panel { position: static; }
        }
    </style>
</head>
<body>

<header>
    <h1>Lesson 06: å®šä½è‡ªå·±çš„ä½ç½® â€” å°ç·šæ¸¬é‡èˆ‡å¾Œæ–¹äº¤æœƒ</h1>
    <p style="color: #64748b; font-size: 18px; margin-bottom: 0;">Road to Expert: æ‰¾ä¸åˆ°å·²çŸ¥é»æ¶å„€å™¨ï¼Ÿé‚£å°±æŠŠå„€å™¨æ¶åœ¨ä»»æ„é»ï¼Œç”¨æ•¸å­¸æŠŠå·²çŸ¥é»ã€ŒæŠ“ã€éä¾†ã€‚</p>
</header>

<div class="container">
    <div class="theory-column">
        
        <h2>âš“ ç›´è§€è­¬å–»ï¼šæµ·ä¸Šçš„ç‡ˆå¡”</h2>
        <p>æƒ³åƒä½ åœ¨èŒ«èŒ«å¤§æµ·ä¸Šé–‹èˆ¹ï¼ˆå„€å™¨ä»»æ„è¨­ç«™ï¼‰ï¼Œä½ ä¸çŸ¥é“è‡ªå·±çš„åæ¨™ã€‚
        <br>ä½†ä½ çœ‹åˆ°äº†é æ–¹å…©åº§ç‡ˆå¡” A å’Œ Bï¼ˆå·²çŸ¥æ§åˆ¶é»ï¼‰ã€‚</p>
        <p>åªè¦ä½ ç”¨é›·é”æ¸¬å‡º<strong>ã€Œä½ åˆ° A çš„è·é›¢ã€</strong>å’Œ<strong>ã€Œä½ åˆ° B çš„è·é›¢ã€</strong>ï¼Œä½ çš„ä½ç½®å°±è¢«é–å®šäº†ã€‚</p>
        <p>é€™åœ¨æ•¸å­¸ä¸Šå«ã€Œåœ“çš„äº¤æœƒã€ã€‚ä½ å°±ä½æ–¼ä»¥ A ç‚ºåœ“å¿ƒ (åŠå¾‘=æ¸¬è·A) å’Œä»¥ B ç‚ºåœ“å¿ƒ (åŠå¾‘=æ¸¬è·B) çš„å…©å€‹åœ“çš„äº¤é»ä¸Šã€‚
        <br>å”¯ä¸€çš„é™·é˜±æ˜¯ï¼šå…©å€‹åœ“é€šå¸¸æœ‰å…©å€‹äº¤é»ï¼ˆé¡åƒè§£ï¼‰ã€‚ä½†èº«ç‚ºå·¥ç¨‹å¸«ï¼Œä½ è‚¯å®šçŸ¥é“è‡ªå·±åœ¨ç·šçš„å·¦é‚Šé‚„æ˜¯å³é‚Šï¼Œå°å§ï¼Ÿ</p>

        <h2>ğŸ“ è¦–è¦ºåœ–è§£ï¼šè·é›¢å¾Œæ–¹äº¤æœƒ (Resection by Distance)</h2>
        <div class="svg-container">
            <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f1f5f9" stroke-width="1"/>
                    </pattern>
                </defs>
                <rect width="800" height="400" fill="url(#grid)" />

                <circle cx="200" cy="100" r="8" fill="#e11d48"/>
                <text x="200" y="80" text-anchor="middle" font-weight="bold" fill="#e11d48">å·²çŸ¥é» A</text>
                
                <circle cx="600" cy="100" r="8" fill="#e11d48"/>
                <text x="600" y="80" text-anchor="middle" font-weight="bold" fill="#e11d48">å·²çŸ¥é» B</text>

                <line x1="200" y1="100" x2="600" y2="100" stroke="#cbd5e1" stroke-dasharray="5"/>

                <circle cx="400" cy="350" r="10" fill="#06b6d4" stroke="white" stroke-width="3"/>
                <text x="400" y="380" text-anchor="middle" font-weight="bold" fill="#06b6d4">æœªçŸ¥æ¸¬ç«™ P</text>

                <line x1="400" y1="350" x2="200" y2="100" stroke="#06b6d4" stroke-width="2"/>
                <text x="280" y="240" fill="#06b6d4" font-weight="bold">è·é›¢ a</text>

                <line x1="400" y1="350" x2="600" y2="100" stroke="#06b6d4" stroke-width="2"/>
                <text x="520" y="240" fill="#06b6d4" font-weight="bold">è·é›¢ b</text>

                <path d="M 230 140 Q 250 120 250 100" fill="none" stroke="#f97316" stroke-width="2"/>
                <text x="260" y="140" fill="#f97316">è§£ç®—è§’ Î¸</text>
            </svg>
            <p style="font-size: 16px; color: #64748b; margin-top: 10px;">åœ–è§£ï¼šé€éæ¸¬é‡ P åˆ° Aã€B çš„è·é›¢ï¼Œå½¢æˆä¸€å€‹ä¸‰è§’å½¢ã€‚åˆ©ç”¨ã€Œé¤˜å¼¦å®šç†ã€è§£å‡ºè§’åº¦ï¼Œå†æ¨ç®—åæ¨™ã€‚</p>
        </div>

        <h2>ğŸ§® ç¡¬æ ¸ç†è«–ï¼šé¤˜å¼¦å®šç†å®šæ±Ÿå±±</h2>
        <p>æˆ‘å€‘çŸ¥é“ Aã€B åæ¨™ï¼Œæ‰€ä»¥å¯ä»¥ç®—å‡ºé‚Šé•· $C$ (Aåˆ°Bçš„è·é›¢)ã€‚
        <br>ç¾åœ¨ä¸‰è§’å½¢ä¸‰é‚Šé•· $a$ (æ¸¬è·A), $b$ (æ¸¬è·B), $C$ (å·²çŸ¥) éƒ½çŸ¥é“äº†ã€‚</p>
        
        <p><strong>Step 1: ç®—å‡ºå…§è§’ A</strong></p>
        <div class="math-card">
            \cos A = \frac{b^2 + C^2 - a^2}{2bC}
        </div>
        <p>æ³¨æ„ï¼šé€™è£¡çš„ $a, b, C$ å°æ‡‰é€šå¸¸ç¿’æ…£ï¼Œæˆ‘å€‘ç¨å¾Œåœ¨å·¥å…·ä¸­æœƒç”¨ $Dist_A, Dist_B, Dist_{AB}$ ä¾†è¡¨ç¤ºã€‚</p>

        <p><strong>Step 2: åæ¨™æ–¹ä½è§’æ¨ç®—</strong></p>
        <p>å…ˆç®—å·²çŸ¥é‚Š AB çš„æ–¹ä½è§’ $\phi_{AB}$ã€‚
        <br>æ¸¬ç«™ P çš„æ–¹ä½è§’ $\phi_{AP} = \phi_{AB} \pm \angle A$ã€‚
        <br>(åŠ æˆ–æ¸›å–æ±ºæ–¼ P åœ¨ AB é€£ç·šçš„å“ªä¸€å´)</p>

        <p><strong>Step 3: åæ¨™æ­£ç®—</strong></p>
        <div class="math-card">
            N_P = N_A + Dist_A \times \cos(\phi_{AP})<br>
            E_P = E_A + Dist_A \times \sin(\phi_{AP})
        </div>
    </div>

    <div class="field-column">
        
        <div class="field-panel">
            <h2>ğŸ‘· ä¸»ä»»çš„å°è¬›æ©Ÿï¼šåœ–å½¢å¼·åº¦ (Geometry)</h2>
            
            <h3>1. å±éšªåœ“ (Danger Circle)</h3>
            <p>å¦‚æœä½ åªæ¸¬è§’åº¦ï¼ˆå¾Œæ–¹äº¤æœƒï¼‰ï¼Œç•¶ä½ å’Œå…©å€‹å·²çŸ¥é» Aã€B å‰›å¥½åœ¨åŒä¸€å€‹åœ“å‘¨ä¸Šæ™‚ï¼Œ<strong>ç„¡è§£ï¼</strong> è¨ˆç®—æ©Ÿæœƒç®—å‡ºç„¡é™å¤šçµ„è§£ï¼Œä½ çš„åæ¨™æœƒäº‚é£„ã€‚
            <br>ä½†åœ¨ã€Œæ¸¬è·äº¤æœƒã€ä¸­ï¼Œå±éšªçš„æ˜¯<strong>ã€Œä¸€ç›´ç·šã€</strong>ã€‚å¦‚æœä½ ç«™åœ¨ Aã€B çš„é€£ç·šä¸Šï¼Œæˆ–è€… A-P-B å¤¾è§’æ¥è¿‘ 180 åº¦ï¼Œé€™æ™‚åœ–å½¢å¼·åº¦æœ€å¼±ï¼Œäº›å¾®çš„è·é›¢èª¤å·®æœƒå°è‡´åæ¨™åŠ‡çƒˆåç§»ã€‚</p>

            <h3>2. é»ƒé‡‘å¤¾è§’</h3>
            <p>æœ€å®Œç¾çš„äº¤æœƒè§’åº¦æ˜¯ <strong>90åº¦</strong>ã€‚
            <br>æœ€å·®çš„è§’åº¦æ˜¯ 0åº¦ æˆ– 180åº¦ã€‚
            <br><strong>å¯¦å‹™æ³•å‰‡ï¼š</strong> é¸æ“‡å·²çŸ¥é»æ™‚ï¼Œç›¡é‡è®“å¤¾è§’ä¿æŒåœ¨ <strong>60åº¦ ~ 120åº¦</strong> ä¹‹é–“ã€‚å¦‚æœåªèƒ½é¸å¾ˆè¿‘çš„å…©å€‹é»ï¼Œå¯§å¯å¤šè·‘ä¸€è¶Ÿå¼•é»ï¼Œä¹Ÿä¸è¦å¼·è¡Œäº¤æœƒã€‚</p>
        </div>

        <div class="tool-panel">
            <h2>ğŸ›°ï¸ äº’å‹•å·¥å…·ï¼šé›™é»è·é›¢å¾Œæ–¹äº¤æœƒæ¨¡æ“¬å™¨</h2>
            <p>åªè¦èƒ½çœ‹åˆ°å…©å€‹å·²çŸ¥é»ï¼Œå°±èƒ½ç®—å‡ºä½ ç¾åœ¨åœ¨å“ªè£¡ã€‚</p>
            
            <div class="input-group">
                <h3>ğŸ“ å·²çŸ¥é» A (Known Point A)</h3>
                <div class="input-grid">
                    <div>
                        <label>N (åŒ—åæ¨™)</label>
                        <input type="number" id="nA" value="1000.000">
                    </div>
                    <div>
                        <label>E (æ±åæ¨™)</label>
                        <input type="number" id="eA" value="1000.000">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="color:#06b6d4;">å¯¦æ¸¬è·é›¢ Dist A (m)</label>
                        <input type="number" id="distA" value="50.000" style="border-color:#06b6d4;">
                    </div>
                </div>
            </div>

            <div class="input-group">
                <h3>ğŸ“ å·²çŸ¥é» B (Known Point B)</h3>
                <div class="input-grid">
                    <div>
                        <label>N (åŒ—åæ¨™)</label>
                        <input type="number" id="nB" value="1050.000">
                    </div>
                    <div>
                        <label>E (æ±åæ¨™)</label>
                        <input type="number" id="eB" value="1050.000">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label style="color:#06b6d4;">å¯¦æ¸¬è·é›¢ Dist B (m)</label>
                        <input type="number" id="distB" value="50.000" style="border-color:#06b6d4;">
                    </div>
                </div>
            </div>

            <div style="margin-bottom:15px;">
                <label>æ¸¬ç«™ä½æ–¼ AB é€£ç·šè¡Œé€²æ–¹å‘çš„ï¼š</label>
                <select id="side" style="padding:10px; background:#1e293b; color:white; border:1px solid #475569; border-radius:4px; width:100%;">
                    <option value="right">å³å´ (Right Side)</option>
                    <option value="left">å·¦å´ (Left Side)</option>
                </select>
            </div>

            <button class="btn" onclick="calcResection()">ğŸ“¡ è¨ˆç®—æ¸¬ç«™åæ¨™</button>

            <div class="result-screen" id="result-screen" style="display:none;">
                <div style="border-bottom: 1px dashed #333; padding-bottom:10px; margin-bottom:10px;">
                    <span class="res-label">å¹¾ä½•æª¢æ ¸ (Geometry Check):</span>
                    <span id="res-angle" style="display:block; color:#f97316;">--</span>
                </div>
                <div>
                    <span class="res-label">æ¸¬ç«™åŒ—åæ¨™ (N):</span>
                    <span class="res-coord" id="res-nP">--</span>
                </div>
                <div>
                    <span class="res-label">æ¸¬ç«™æ±åæ¨™ (E):</span>
                    <span class="res-coord" id="res-eP">--</span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function calcResection() {
        // 1. ç²å–æ•¸æ“š
        const nA = parseFloat(document.getElementById('nA').value);
        const eA = parseFloat(document.getElementById('eA').value);
        const dA = parseFloat(document.getElementById('distA').value);

        const nB = parseFloat(document.getElementById('nB').value);
        const eB = parseFloat(document.getElementById('eB').value);
        const dB = parseFloat(document.getElementById('distB').value);

        const side = document.getElementById('side').value;

        if ([nA, eA, dA, nB, eB, dB].some(isNaN)) {
            alert("è«‹è¼¸å…¥å®Œæ•´æ•¸æ“šï¼");
            return;
        }

        // 2. è¨ˆç®— AB é‚Šé•·èˆ‡æ–¹ä½è§’
        const dN = nB - nA;
        const dE = eB - eA;
        const distAB = Math.sqrt(dN*dN + dE*dE);
        
        // æ•¸å­¸æ–¹ä½è§’ atan2(y, x) -> æ¸¬é‡æ–¹ä½è§’ atan2(dE, dN)
        let azAB = Math.atan2(dE, dN); // å¼§åº¦
        if (azAB < 0) azAB += 2 * Math.PI;

        // 3. ä¸‰è§’å½¢åˆæ³•æ€§æª¢æŸ¥ (å…©é‚Šä¹‹å’Œ > ç¬¬ä¸‰é‚Š)
        if (dA + dB < distAB || Math.abs(dA - dB) > distAB) {
            alert("éŒ¯èª¤ï¼šè¼¸å…¥çš„è·é›¢ç„¡æ³•æ§‹æˆä¸‰è§’å½¢ï¼(å¤ªçŸ­æˆ–å¤ªé•·)");
            return;
        }

        // 4. é¤˜å¼¦å®šç†æ±‚è§£å…§è§’ A (Påœ¨Aè™•çš„å¤¾è§’)
        // dB^2 = dA^2 + distAB^2 - 2 * dA * distAB * cos(Angle_A)
        // cos(Angle_A) = (dA^2 + distAB^2 - dB^2) / (2 * dA * distAB)
        const cosA = (dA*dA + distAB*distAB - dB*dB) / (2 * dA * distAB);
        const angleA = Math.acos(cosA); // å¼§åº¦ (0 ~ PI)

        // 5. è¨ˆç®— AP çš„æ–¹ä½è§’
        let azAP;
        if (side === 'right') {
            // å¦‚æœ P åœ¨ AB å³å´ï¼Œå‰‡ AP æ–¹ä½è§’ = AB æ–¹ä½è§’ + Angle A
            azAP = azAB + angleA;
        } else {
            // å¦‚æœ P åœ¨ AB å·¦å´ï¼Œå‰‡ AP æ–¹ä½è§’ = AB æ–¹ä½è§’ - Angle A
            azAP = azAB - angleA;
        }

        // 6. åæ¨™æ­£ç®—
        const nP = nA + dA * Math.cos(azAP);
        const eP = eA + dA * Math.sin(azAP);

        // 7. è¨ˆç®—äº¤æœƒè§’ (Pé»å¤¾è§’) ä»¥è©•ä¼°åœ–å½¢å¼·åº¦
        // distAB^2 = dA^2 + dB^2 - 2*dA*dB*cos(P)
        const cosP = (dA*dA + dB*dB - distAB*distAB) / (2 * dA * dB);
        const angleP_deg = Math.acos(cosP) * (180 / Math.PI);

        // é¡¯ç¤ºçµæœ
        document.getElementById('res-nP').innerText = nP.toFixed(4);
        document.getElementById('res-eP').innerText = eP.toFixed(4);
        
        const angleStatus = (angleP_deg >= 30 && angleP_deg <= 150) ? "è‰¯å¥½ (Good)" : "ä¸ä½³ (Poor) - å»ºè­°æ›´æ›æ§åˆ¶é»";
        const angleColor = (angleP_deg >= 30 && angleP_deg <= 150) ? "#4ade80" : "#ef4444";
        
        document.getElementById('res-angle').innerHTML = `äº¤æœƒå¤¾è§’: ${angleP_deg.toFixed(1)}Â° <span style="color:${angleColor}; margin-left:10px;">[${angleStatus}]</span>`;
        
        document.getElementById('result-screen').style.display = 'block';
    }
</script>

</body>
</html>